local WindUI

do
    local ok, result = pcall(function()
        return require("./src/init")
    end)
    
    if ok then
        WindUI = result
    else 
        WindUI = loadstring(game:HttpGet("https://github.com/Footagesus/WindUI/releases/latest/download/main.lua"))()
    end
end

-- Ambil nama player
local player = game.Players.LocalPlayer
local playerName = player.Name
local playerDisplayName = player.DisplayName

-- Buat Window versi baru
local Window = WindUI:CreateWindow({
    Title = "Nexa - Premium",
    Icon = "rbxassetid://131269662643486",
    Author = "Fish IT! Script | @ Han",
    Folder = "Hanzo",
    Size = UDim2.fromOffset(650, 510),
    Transparent = true,
    Theme = "Plant",
    
    HidePanelBackground = true,
    NewElements = false,
    User = {
        Enabled = true,
        Anonymous = false,           -- false biar muncul nama asli
        Name = playerDisplayName,    -- Nama tampilan
        UserName = "@" .. playerName, -- Username Roblox
        Callback = function()
            WindUI:Notify({
                Title = "User Profile",
                Content = "User profile clicked!",
                Duration = 3
            })
        end
    },
    
    Acrylic = false,
    HideSearchBar = false,
    SideBarWidth = 200,
})

Window:EditOpenButton({
    Enabled = false
})

local Tabs = {
    Home = Window:Tab({ Title = "Home", Icon = "house"  }),
    Admin = Window:Tab({ Title = "Panel", Icon = "user-star"  }),
}

Tabs.Home:Section({ Title = "Update" })

Tabs.Home:Paragraph({
    Title = "Here's what's new:",
    Desc = [[
[+] Added Auto Element (Auto Element Won't Auto Craft transcendent stone)
    ]]
})

Tabs.Home:Section({ Title = "Server" })

Tabs.Home:Paragraph({
    Title = "Discord - Nexa | COMMUNITY",
    Desc = "Indonesia üáÆüá©",
    Image = "https://images-eds-ssl.xboxlive.com/image?url=4rt9.lXDC4H_93laV1_eHHFT949fUipzkiFOBH3fAiZZUCdYojwUyX2aTonS1aIwMrx6NUIsHfUHSLzjGJFxxsG72wAo9EWJR4yQWyJJaDaK1XdUso6cUMpI9hAdPUU_FNs11cY1X284vsHrnWtRw7oqRpN1m9YAg21d_aNKnIo-&format=source",
    ImageSize = 20,
    Color = "Grey",
    Buttons = {
        {
            Title = "Copy Link",
            Icon = "copy",
            Variant = "Tertiary",
            Callback = function()
                setclipboard("discord.gg/ECxQFc97F5")
                WindUI:Notify({
                    Title = "Copied!",
                    Content = "Discord link copied to clipboard",
                    Duration = 2
                })
            end
        }
    }
})

Tabs.Admin:Section({ Title = "Admin Panel" })

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local LocalPlayer = Players.LocalPlayer
local Camera = workspace.CurrentCamera

local selectedPlayerName = nil
local follow = false
local followConnection = nil
local cameraOffset = Vector3.new(0, 5, -10)

-- Fungsi update dropdown player
local function updatePlayerList(dropdown)
    local playerNames = {}
    for _, player in ipairs(Players:GetPlayers()) do
        if player ~= LocalPlayer then
            table.insert(playerNames, player.Name)
        end
    end
    dropdown.Values = playerNames -- Update table, bukan fungsi
    if dropdown.Refresh then dropdown:Refresh() end -- Jika framework mendukung
end

-- Membuat Dropdown player
local playerDropdown = Tabs.Admin:Dropdown({
    Title = "Select Player",
    Values = {},
    Value = "",
    Callback = function(option)
        selectedPlayerName = option
    end
})

-- Tombol Teleport ke Player
Tabs.Admin:Button({
    Title = "Teleport To Player",
    Callback = function()
        if not selectedPlayerName or selectedPlayerName == "" then
            WindUI:Notify({Title = "Error", Content = "Pilih player dulu!", Duration = 5})
            return
        end
        
        local targetPlayer = Players:FindFirstChild(selectedPlayerName)
        if targetPlayer and targetPlayer.Character and targetPlayer.Character:FindFirstChild("HumanoidRootPart") then
            local hrp = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
            if hrp then
                hrp.CFrame = targetPlayer.Character.HumanoidRootPart.CFrame + Vector3.new(0,5,0)
                WindUI:Notify({Title = "Success", Content = "Teleported to " .. selectedPlayerName, Duration = 5})
            else
                WindUI:Notify({Title = "Error", Content = "Karaktermu belum siap!", Duration = 5})
            end
        else
            WindUI:Notify({Title = "Error", Content = "Player tidak ditemukan atau belum spawn!", Duration = 5})
        end
    end
})

-- Tombol View Player (Follow Camera)
Tabs.Admin:Button({
    Title = "View Player",
    Callback = function()
        if not selectedPlayerName or selectedPlayerName == "" then
            WindUI:Notify({Title = "Error", Content = "Pilih player dulu!", Duration = 5})
            return
        end

        local targetPlayer = Players:FindFirstChild(selectedPlayerName)
        local targetHRP = targetPlayer and targetPlayer.Character and targetPlayer.Character:FindFirstChild("HumanoidRootPart")
        if not targetHRP then
            WindUI:Notify({Title = "Error", Content = "Player tidak ditemukan atau belum spawn!", Duration = 5})
            return
        end

        follow = true
        if followConnection then followConnection:Disconnect() end
        
        followConnection = RunService.RenderStepped:Connect(function()
            if follow and targetHRP and Camera then
                local camPos = targetHRP.Position + cameraOffset
                Camera.CFrame = CFrame.new(camPos, targetHRP.Position)
            else
                if followConnection then
                    followConnection:Disconnect()
                    followConnection = nil
                end
            end
        end)

        WindUI:Notify({Title = "Viewing Player", Content = "Sekarang melihat: " .. selectedPlayerName, Duration = 5})
    end
})

-- Tombol UnView Player
Tabs.Admin:Button({
    Title = "UnView Player",
    Callback = function()
        follow = false
        if followConnection then
            followConnection:Disconnect()
            followConnection = nil
        end

        local hrp = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
        if hrp and Camera then
            Camera.CFrame = CFrame.new(hrp.Position + cameraOffset, hrp.Position)
        end

        WindUI:Notify({Title = "Stopped Viewing", Content = "Camera sudah kembali normal", Duration = 5})
    end
})

-- Tombol Refresh Player List
Tabs.Admin:Button({
    Title = "Refresh Player List",
    Callback = function()
        updatePlayerList(playerDropdown)
        WindUI:Notify({Title = "Success", Content = "Player list berhasil diperbarui", Duration = 5})
    end
})

-- Auto update dropdown saat ada player join atau leave
Players.PlayerAdded:Connect(function()
    updatePlayerList(playerDropdown)
end)
Players.PlayerRemoving:Connect(function()
    updatePlayerList(playerDropdown)
end)

-- Inisialisasi awal dropdown
updatePlayerList(playerDropdown)


-------------------------------------------------------
-- TOGGLE BUTTON (PUTIH AGAK TRANSPARAN)
-------------------------------------------------------
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")

local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Parent = game.CoreGui
ScreenGui.Name = "WindUIButton"

-- üîò ImageButton utama
local ImgBtn = Instance.new("ImageButton")
ImgBtn.Parent = ScreenGui
ImgBtn.Size = UDim2.new(0, 60, 0, 60)
ImgBtn.Position = UDim2.new(0, 100, 1, -300)
ImgBtn.BackgroundColor3 = Color3.fromRGB(255, 255, 255) -- warna putih
ImgBtn.BackgroundTransparency = 0.3 -- agak transparan
ImgBtn.Image = "rbxassetid://131269662643486" -- icon planet
ImgBtn.ImageTransparency = 0.15 -- icon sedikit transparan juga
ImgBtn.ImageColor3 = Color3.fromRGB(255, 255, 255)
ImgBtn.AutoButtonColor = false

-- üî≤ Sudut membulat
local UICorner = Instance.new("UICorner")
UICorner.CornerRadius = UDim.new(1, 0) -- full bulat
UICorner.Parent = ImgBtn

-- ‚úèÔ∏è Garis pinggir halus
local UIStroke = Instance.new("UIStroke")
UIStroke.Color = Color3.fromRGB(200, 200, 200)
UIStroke.Thickness = 2
UIStroke.Transparency = 0.4 -- agak transparan
UIStroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
UIStroke.Parent = ImgBtn

local isOpen = false

-- üîÑ Animasi klik
local function playClickAnim()
	local shrink = TweenService:Create(ImgBtn, TweenInfo.new(0.1, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
		Size = UDim2.new(0, 50, 0, 50),
		BackgroundTransparency = 0.45
	})
	local grow = TweenService:Create(ImgBtn, TweenInfo.new(0.15, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
		Size = UDim2.new(0, 60, 0, 60),
		BackgroundTransparency = 0.3
	})
	shrink:Play()
	shrink.Completed:Wait()
	grow:Play()
end

-- üü¢ Buka/tutup GUI
ImgBtn.MouseButton1Click:Connect(function()
	playClickAnim()
	isOpen = not isOpen
	if isOpen then
		Window:Open()
	else
		Window:Close()
	end
end)

-- üñ±Ô∏è Drag agar bisa dipindah
local dragging, dragInput, dragStart, startPos

local function update(input)
	local delta = input.Position - dragStart
	ImgBtn.Position = UDim2.new(
		startPos.X.Scale, startPos.X.Offset + delta.X,
		startPos.Y.Scale, startPos.Y.Offset + delta.Y
	)
end

ImgBtn.InputBegan:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
		dragging = true
		dragStart = input.Position
		startPos = ImgBtn.Position
		input.Changed:Connect(function()
			if input.UserInputState == Enum.UserInputState.End then dragging = false end
		end)
	end
end)

ImgBtn.InputChanged:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
		dragInput = input
	end
end)

UserInputService.InputChanged:Connect(function(input)
	if input == dragInput and dragging then
		update(input)
	end
end)
