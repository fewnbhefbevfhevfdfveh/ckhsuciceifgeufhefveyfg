-- SERVICES
local TweenService = game:GetService("TweenService")
local Players = game:GetService("Players")
local HttpService = game:GetService("HttpService")
local player = Players.LocalPlayer
local PlayerGui = player:WaitForChild("PlayerGui")

-- EXECUTOR REQUEST FUNCTION
local Request = (syn and syn.request)
	or http_request
	or request
	or (fluxus and fluxus.request)

if not Request then
	player:Kick("Executor not supported")
	return
end

-- API URL dan SCRIPT URL
local API_URL = "https://han2343.pythonanywhere.com/check"
local SCRIPT_URL = "https://han2343.pythonanywhere.com/premium_script.lua?key=secret_premium_key_123"

-- GUI Input Key
local ScreenGui = Instance.new("ScreenGui", PlayerGui)
ScreenGui.Name = "KeyInputGui"

local Frame = Instance.new("Frame", ScreenGui)
Frame.Size = UDim2.new(0, 300, 0, 100)
Frame.Position = UDim2.new(0.5, -150, 0.5, -50)
Frame.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
Frame.BorderSizePixel = 0
Frame.AnchorPoint = Vector2.new(0.5, 0.5)
Instance.new("UICorner", Frame)

local TextBox = Instance.new("TextBox", Frame)
TextBox.Size = UDim2.new(1, -20, 0, 30)
TextBox.Position = UDim2.new(0, 10, 0, 20)
TextBox.PlaceholderText = "Enter your premium key here"
TextBox.ClearTextOnFocus = false
TextBox.Text = ""

local Button = Instance.new("TextButton", Frame)
Button.Size = UDim2.new(0, 100, 0, 30)
Button.Position = UDim2.new(0.5, -50, 1, -40)
Button.AnchorPoint = Vector2.new(0.5, 1)
Button.Text = "Submit"
Button.BackgroundColor3 = Color3.fromRGB(255, 130, 0)
Button.TextColor3 = Color3.fromRGB(0, 0, 0)
Instance.new("UICorner", Button)

local function ShowNotification(text)
	if PlayerGui:FindFirstChild("NexaNotify") then
		PlayerGui.NexaNotify:Destroy()
	end

	local gui = Instance.new("ScreenGui", PlayerGui)
	gui.Name = "NexaNotify"

	local frame = Instance.new("Frame", gui)
	frame.Size = UDim2.new(0, 300, 0, 60)
	frame.Position = UDim2.new(0.5, 0, 0, -80)
	frame.AnchorPoint = Vector2.new(0.5, 0)
	frame.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
	frame.BorderColor3 = Color3.fromRGB(60, 60, 60)
	Instance.new("UICorner", frame)

	local label = Instance.new("TextLabel", frame)
	label.Size = UDim2.new(1, -20, 1, 0)
	label.Position = UDim2.new(0, 10, 0, 0)
	label.BackgroundTransparency = 1
	label.TextWrapped = true
	label.Font = Enum.Font.Code
	label.TextSize = 14
	label.TextColor3 = Color3.fromRGB(255, 130, 0)
	label.Text = text

	TweenService:Create(frame, TweenInfo.new(0.3, Enum.EasingStyle.Quint), {
		Position = UDim2.new(0.5, 0, 0, 40)
	}):Play()

	task.delay(2, function()
		TweenService:Create(frame, TweenInfo.new(0.3, Enum.EasingStyle.Quint), {
			Position = UDim2.new(0.5, 0, 0, -80)
		}):Play()
		task.wait(0.3)
		gui:Destroy()
	end)
end

local function ValidateKey(key)
	-- Request check ke server
	local response = Request({
		Url = API_URL .. "?user_id=" .. player.UserId .. "&key=" .. key,
		Method = "GET",
		Headers = { ["Content-Type"] = "application/json" }
	})

	if not response or not response.Body then
		ShowNotification("‚ùå Gagal terhubung ke server.")
		task.wait(2)
		player:Kick("‚ùå Failed to connect to server")
		return false
	end

	local data = nil
	local success, err = pcall(function()
		data = HttpService:JSONDecode(response.Body)
	end)
	if not success then
		ShowNotification("‚ùå Response server tidak valid.")
		task.wait(2)
		player:Kick("‚ùå Invalid server response")
		return false
	end

	if not data.allowed then
		if data.reason == "user_not_whitelisted" then
			ShowNotification("‚ùå Kamu bukan pengguna Premium.")
			task.wait(2)
			player:Kick("‚ùå You are not whitelisted.")
		elseif data.reason == "invalid_key" then
			ShowNotification("‚ùå Key Premium salah.")
			task.wait(2)
			player:Kick("‚ùå Invalid key.")
		else
			ShowNotification("‚ùå Akses ditolak.")
			task.wait(2)
			player:Kick("‚ùå Access denied.")
		end
		return false
	end

	return true
end

Button.MouseButton1Click:Connect(function()
	local enteredKey = TextBox.Text
	if enteredKey == "" then
		ShowNotification("‚ùå Key tidak boleh kosong.")
		return
	end

	if ValidateKey(enteredKey) then
		ShowNotification("üíé Lifetime Premium Access Granted!")
		task.wait(1)
		ScreenGui:Destroy()

		-- Load script premium dengan key proteksi
		pcall(function()
			loadstring(game:HttpGet(SCRIPT_URL .. "?key=" .. "secret_premium_key_123"))()
		end)
	end
end)
