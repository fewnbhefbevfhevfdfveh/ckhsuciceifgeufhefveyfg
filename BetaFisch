-- ======================== Auto Shake ========================

local VirtualInputManager = game:GetService("VirtualInputManager")
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local PlayerGUI = LocalPlayer:FindFirstChildOfClass("PlayerGui")
local RunService = game:GetService("RunService")
local RenderStepped = RunService.RenderStepped

local autoShake = false
local autoShakeDelay = 0.001
local autoShakeMethod = "KeyCodeEvent"

-- Sistem utama Auto Shake
local autoreelandshakeConnection = PlayerGUI.ChildAdded:Connect(function(GUI)
    if GUI:IsA("ScreenGui") and GUI.Name == "shakeui" then
        if GUI:FindFirstChild("safezone") then
            GUI.safezone.ChildAdded:Connect(function(child)
                if child:IsA("ImageButton") and child.Name == "button" then
                    if autoShake then
                        task.wait(autoShakeDelay)
                        if child.Visible then
                            if autoShakeMethod == "ClickEvent" then
                                local pos = child.AbsolutePosition
                                local size = child.AbsoluteSize
                                VirtualInputManager:SendMouseButtonEvent(pos.X + size.X / 2, pos.Y + size.Y / 2, 0, true, LocalPlayer, 0)
                                VirtualInputManager:SendMouseButtonEvent(pos.X + size.X / 2, pos.Y + size.Y / 2, 0, false, LocalPlayer, 0)
                            elseif autoShakeMethod == "KeyCodeEvent" then
                                while RenderStepped:Wait() do
                                    if autoShake and GUI.safezone:FindFirstChild(child.Name) then
                                        task.wait()
                                        pcall(function()
                                            local GuiService = game:GetService("GuiService")
                                            GuiService.SelectedObject = child
                                            if GuiService.SelectedObject == child then
                                                VirtualInputManager:SendKeyEvent(true, Enum.KeyCode.Return, false, game)
                                                VirtualInputManager:SendKeyEvent(false, Enum.KeyCode.Return, false, game)
                                            end
                                        end)
                                    else
                                        local GuiService = game:GetService("GuiService")
                                        GuiService.SelectedObject = nil
                                        break
                                    end
                                end
                            end
                        end
                    end
                end
            end)
        end
    end
end)

-- ======================== Auto Reel ========================

-- Services
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local PlayerGUI = LocalPlayer:FindFirstChildOfClass("PlayerGui")

-- Variables
local autoReel = false
local autoReelDelay = 0.001

-- Auto Reel Handler
PlayerGUI.ChildAdded:Connect(function(GUI)
    if GUI:IsA("ScreenGui") and GUI.Name == "reel" then
        if autoReel then
            repeat
                task.wait(autoReelDelay)
                ReplicatedStorage.events.reelfinished:FireServer(100, false)
            until not GUI or not GUI.Parent
        end
    end
end)

-- ======================== Lock Posisi ========================

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local LocalPlayer = Players.LocalPlayer

-- Variabel utama
local lockPosition = false
local savedPosition

-- Looping untuk kunci posisi
RunService.Heartbeat:Connect(function()
    if lockPosition and LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then
        local root = LocalPlayer.Character.HumanoidRootPart
        root.Velocity = Vector3.zero
        root.RotVelocity = Vector3.zero
        root.CFrame = CFrame.new(savedPosition)
    end
end)

-- ======================== Equip Rod ========================

--// Variables
local Player = game:GetService("Players").LocalPlayer
local Character = Player.Character or Player.CharacterAdded:Wait()
local Backpack = Player:WaitForChild("Backpack")

--// State toggle
local autoEquipRod = false
local isHoldingRod = false

--// Fungsi cari tool yang mengandung kata "Rod"
local function FindRod()
    for _, tool in ipairs(Backpack:GetChildren()) do
        if tool:IsA("Tool") and string.find(tool.Name, "Rod") then
            return tool
        end
    end
end

--// Fungsi cek apakah sedang pegang rod
local function CheckHoldingRod()
    for _, tool in ipairs(Character:GetChildren()) do
        if tool:IsA("Tool") and string.find(tool.Name, "Rod") then
            return true, tool
        end
    end
    return false, nil
end

--// Fungsi equip rod
local function EquipRod()
    local Rod = FindRod()
    if Rod then
        Character.Humanoid:EquipTool(Rod)
    end
end

--// Auto equip loop
task.spawn(function()
    while task.wait(0.1) do
        if autoEquipRod then
            local holding, _ = CheckHoldingRod()
            if holding then
                isHoldingRod = true
            else
                isHoldingRod = false
                EquipRod()
            end
        end
    end
end)

local WindUI = loadstring(game:HttpGet("https://raw.githubusercontent.com/Footagesus/WindUI/main/dist/main.lua"))()

WindUI.TransparencyValue = 0.2
WindUI:SetTheme("Dark")

local function gradient(text, startColor, endColor)
    local result = ""
    for i = 1, #text do
        local t = (i - 1) / (#text - 1)
        local r = math.floor((startColor.R + (endColor.R - startColor.R) * t) * 255)
        local g = math.floor((startColor.G + (endColor.G - startColor.G) * t) * 255)
        local b = math.floor((startColor.B + (endColor.B - startColor.B) * t) * 255)
        result = result .. string.format('<font color="rgb(%d,%d,%d)">%s</font>', r, g, b, text:sub(i, i))
    end
    return result
end

-- Ambil nama player
local player = game.Players.LocalPlayer
local playerName = player.Name
local playerDisplayName = player.DisplayName

-- Buat Window versi baru
local Window = WindUI:CreateWindow({
    Title = "Nexa - Beta",
    Icon = "rbxassetid://107488593993096",
    Author = "Fisch Script | @ Han",
    Folder = "Hanzo",
    Size = UDim2.fromOffset(540, 420),
    Transparent = true,
    Theme = "Dark",
    
    HidePanelBackground = true,
    NewElements = false,
    Background = "https://i.imgur.com/GsfBtXF.jpeg",
    User = {
        Enabled = true,
        Anonymous = false,           -- false biar muncul nama asli
        Name = playerDisplayName,    -- Nama tampilan
        UserName = "@" .. playerName, -- Username Roblox
        Callback = function()
            WindUI:Notify({
                Title = "User Profile",
                Content = "User profile clicked!",
                Duration = 3
            })
        end
    },
    
    Acrylic = false,
    HideSearchBar = false,
    SideBarWidth = 200,
})

Window:Tag({
    Title = "v1.2.7",
    Color = Color3.fromHex("#30ff6a")
})


Window:EditOpenButton({
    Enabled = false
})

-- ✅ Tab dan UI
local Tabs = {
    Home = Window:Tab({ Title = "Home", Icon = "house"  }),
    Farm = Window:Tab({ Title = "Fishing", Icon = "fish"  }),
    Shop = Window:Tab({ Title = "Shop", Icon = "shopping-cart"  }),
    Teleport = Window:Tab({ Title = "Teleport", Icon = "map-pin"  }),
    Server = Window:Tab({ Title = "Server", Icon = "server"  }),
}

Tabs.Home:Section({ Title = "Update" })

Tabs.Home:Paragraph({
    Title = "Here's what's new:",
    Desc = [[
[/] Fixed Auto Sell
    ]]
})

Tabs.Home:Section({ Title = "Server" })

Tabs.Home:Paragraph({
    Title = "Discord - Nexa | COMMUNITY",
    Desc = "Indonesia 🇮🇩",
    Image = "https://images-eds-ssl.xboxlive.com/image?url=4rt9.lXDC4H_93laV1_eHHFT949fUipzkiFOBH3fAiZZUCdYojwUyX2aTonS1aIwMrx6NUIsHfUHSLzjGJFxxsG72wAo9EWJR4yQWyJJaDaK1XdUso6cUMpI9hAdPUU_FNs11cY1X284vsHrnWtRw7oqRpN1m9YAg21d_aNKnIo-&format=source",
    ImageSize = 20,
    Color = "Grey",
    Buttons = {
        {
            Title = "Copy Link",
            Icon = "copy",
            Variant = "Tertiary",
            Callback = function()
                setclipboard("discord.gg/ECxQFc97F5")
                WindUI:Notify({
                    Title = "Copied!",
                    Content = "Discord link copied to clipboard",
                    Duration = 2
                })
            end
        }
    }
})

Tabs.Farm:Section({ Title = "Fishing" })

-- === WindUI Toggle ===
Tabs.Farm:Toggle({
    Title = "Auto Shake",
    Description = "Automatically clicks the shake button for you",
    Default = false,
    Callback = function(state)
        autoShake = state
        if state then
        else
        end
    end
})

local Players = game:GetService("Players")
local player = Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()

local autoCast = false
local delayTime = 0.1

-- fungsi cari rod tool
local function getRodTool()
	for _, tool in pairs(character:GetChildren()) do
		if tool:IsA("Tool") and tool:FindFirstChild("events") and tool.events:FindFirstChild("castAsync") then
			return tool
		end
	end
	return nil
end

-- loop auto cast
local function castLoop()
	while autoCast do
		local rod = getRodTool()
		if rod then
			pcall(function()
				rod.events.castAsync:InvokeServer(80.5, 1)
			end)
		end
		task.wait(delayTime)
	end
end

-- toggle WindUI
Tabs.Farm:Toggle({
    Title = "Auto Cast",
    Value = false,
    Callback = function(state)
        autoCast = state
        if state then
            task.spawn(castLoop)
        end
    end
})

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")

local player = Players.LocalPlayer
local gui = player:WaitForChild("PlayerGui")

local AutoReel = false
local connection

-- WindUI Toggle
Tabs.Farm:Toggle({
    Title = "Auto Reel V1",
    Value = false,
    Callback = function(state)
        AutoReel = state

        if AutoReel then
            -- Tunggu sampai GUI "reel" benar-benar muncul
            local reel
            repeat
                reel = gui:FindFirstChild("reel")
                task.wait(1)
            until reel

            -- Setelah "reel" ada, ambil child berikutnya
            local bar = reel:WaitForChild("bar")
            local playerbar = bar:WaitForChild("playerbar")
            local fish = bar:WaitForChild("fish")

            -- Jalankan pergerakan playerbar mengikuti fish
            connection = RunService.RenderStepped:Connect(function()
                if not AutoReel then return end
                if fish and playerbar then
                    playerbar.Position = fish.Position
                end
            end)
        else
            -- Matikan sistem saat toggle dimatikan
            if connection then
                connection:Disconnect()
                connection = nil
            end
        end
    end
})

-- WindUI Toggle
Tabs.Farm:Toggle({
    Title = "Istant Reel",
    Desc = "Automatically reels in the fishing rod",
    Value = false,
    Callback = function(state)
        autoReel = state
        if state then
        else
        end
    end
})

Tabs.Farm:Toggle({
    Title = "Lock Position",
    Default = false,
    Callback = function(state)
        lockPosition = state
        if lockPosition then
            if LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then
                savedPosition = LocalPlayer.Character.HumanoidRootPart.Position
            end
        end
    end
})

--// WindUI Toggle
Tabs.Farm:Toggle({
    Title = "Auto Equip Rod",
    Value = false,
    Callback = function(state)
        autoEquipRod = state
        if not state then
            isHoldingRod = false
        end
    end
})



-------------------------------------------------------
-- TOGGLE BUTTON (PUTIH AGAK TRANSPARAN)
-------------------------------------------------------
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")

local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Parent = game.CoreGui
ScreenGui.Name = "WindUIButton"

-- 🔘 ImageButton utama
local ImgBtn = Instance.new("ImageButton")
ImgBtn.Parent = ScreenGui
ImgBtn.Size = UDim2.new(0, 60, 0, 60)
ImgBtn.Position = UDim2.new(0, 100, 1, -300)
ImgBtn.BackgroundColor3 = Color3.fromRGB(255, 255, 255) -- warna putih
ImgBtn.BackgroundTransparency = 0.3 -- agak transparan
ImgBtn.Image = "rbxassetid://137184014634632" -- icon planet
ImgBtn.ImageTransparency = 0.15 -- icon sedikit transparan juga
ImgBtn.ImageColor3 = Color3.fromRGB(255, 255, 255)
ImgBtn.AutoButtonColor = false

-- 🔲 Sudut membulat
local UICorner = Instance.new("UICorner")
UICorner.CornerRadius = UDim.new(1, 0) -- full bulat
UICorner.Parent = ImgBtn

-- ✏️ Garis pinggir halus
local UIStroke = Instance.new("UIStroke")
UIStroke.Color = Color3.fromRGB(200, 200, 200)
UIStroke.Thickness = 2
UIStroke.Transparency = 0.4 -- agak transparan
UIStroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
UIStroke.Parent = ImgBtn

local isOpen = false

-- 🔄 Animasi klik
local function playClickAnim()
	local shrink = TweenService:Create(ImgBtn, TweenInfo.new(0.1, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
		Size = UDim2.new(0, 50, 0, 50),
		BackgroundTransparency = 0.45
	})
	local grow = TweenService:Create(ImgBtn, TweenInfo.new(0.15, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
		Size = UDim2.new(0, 60, 0, 60),
		BackgroundTransparency = 0.3
	})
	shrink:Play()
	shrink.Completed:Wait()
	grow:Play()
end

-- 🟢 Buka/tutup GUI
ImgBtn.MouseButton1Click:Connect(function()
	playClickAnim()
	isOpen = not isOpen
	if isOpen then
		Window:Open()
	else
		Window:Close()
	end
end)

-- 🖱️ Drag agar bisa dipindah
local dragging, dragInput, dragStart, startPos

local function update(input)
	local delta = input.Position - dragStart
	ImgBtn.Position = UDim2.new(
		startPos.X.Scale, startPos.X.Offset + delta.X,
		startPos.Y.Scale, startPos.Y.Offset + delta.Y
	)
end

ImgBtn.InputBegan:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
		dragging = true
		dragStart = input.Position
		startPos = ImgBtn.Position
		input.Changed:Connect(function()
			if input.UserInputState == Enum.UserInputState.End then dragging = false end
		end)
	end
end)

ImgBtn.InputChanged:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
		dragInput = input
	end
end)

UserInputService.InputChanged:Connect(function(input)
	if input == dragInput and dragging then
		update(input)
	end
end)
