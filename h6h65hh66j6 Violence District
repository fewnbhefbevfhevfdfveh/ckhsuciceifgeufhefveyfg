
local map = workspace:WaitForChild("Map")

-- Fungsi rename generator
local function renameGenerators()
	local count = 0
	for _, obj in ipairs(map:GetChildren()) do
		if obj:IsA("Model") and string.find(obj.Name, "Generator") then
			count += 1
			obj.Name = "Generator " .. count
		end
	end
end

-- Jalankan saat pertama kali
renameGenerators()

-- Kalau ada model Generator baru ditambahkan ke Map
map.ChildAdded:Connect(function(child)
	task.wait(0.5)
	if child:IsA("Model") and string.find(child.Name, "Generator") then
		renameGenerators()
	end
end)



local WindUI = loadstring(game:HttpGet("https://github.com/Footagesus/WindUI/releases/latest/download/main.lua"))()

-- Ambil nama player
local player = game.Players.LocalPlayer
local playerName = player.Name
local playerDisplayName = player.DisplayName

-- Buat Window
local Window = WindUI:CreateWindow({
    Title = "Nexa - Premium",
    Icon = "rbxassetid://131269662643486",
    Author = "Violence District Script | @ Han",
    Folder = "Hanzo",
    Size = UDim2.fromOffset(650, 510),

    Theme = "Plant",
    Transparent = true,
    Acrylic = false,
    HidePanelBackground = true,
    HideSearchBar = false,
    NewElements = true,
    SideBarWidth = 200,

    -- Profil user di pojok kanan atas
    User = {
        Enabled = true,
        Anonymous = false,
        Name = playerDisplayName,
        UserName = "@" .. playerName,
        Callback = function()
            WindUI:Notify({
                Title = "User Profile",
                Content = "User profile clicked!",
                Duration = 3
            })
        end
    }
})

Window:Tag({
    Title = "v1.2.9",
    Color = Color3.fromHex("#30ff6a")
})


Window:EditOpenButton({
    Enabled = false
})

local Tabs = {
    Home = Window:Tab({ Title = "Home", Icon = "house"  }),
    Main = Window:Tab({ Title = "Main", Icon = "swords"  }),
    Visual = Window:Tab({ Title = "Visual", Icon = "eye"  }),
}

Tabs.Home:Section({ Title = "Update", Icon = "logs" })

Tabs.Home:Section({
        Title = "Here's what's new:",
        TextSize = 24,
        FontWeight = Enum.FontWeight.SemiBold,
    })

Tabs.Home:Section({
        Title = [[

		]],
        TextSize = 18,
        TextTransparency = .35,
        FontWeight = Enum.FontWeight.Medium,
    })

Tabs.Home:Section({ Title = "Server" })

Tabs.Home:Paragraph({
    Title = "Nexa Hub",
    Image = "https://i.imgur.com/vl0g8IK.png",
    ImageSize = 42, -- default 30
    Thumbnail = "https://i.imgur.com/3m8FV2y.jpeg",
    ThumbnailSize = 120 -- Thumbnail height
})

Tabs.Home:Paragraph({
    Title = "Discord - Nexa | COMMUNITY",
    Desc = "Indonesia ðŸ‡®ðŸ‡©",
    Image = "https://images-eds-ssl.xboxlive.com/image?url=4rt9.lXDC4H_93laV1_eHHFT949fUipzkiFOBH3fAiZZUCdYojwUyX2aTonS1aIwMrx6NUIsHfUHSLzjGJFxxsG72wAo9EWJR4yQWyJJaDaK1XdUso6cUMpI9hAdPUU_FNs11cY1X284vsHrnWtRw7oqRpN1m9YAg21d_aNKnIo-&format=source",
    ImageSize = 40,
    Color = "Grey",
    Buttons = {
        {
            Title = "Copy Link",
            Icon = "copy",
            Variant = "Tertiary",
            Callback = function()
                setclipboard("discord.gg/ECxQFc97F5")
                WindUI:Notify({
                    Title = "Copied!",
                    Content = "Discord link copied to clipboard",
                    Duration = 2
                })
            end
        }
    }
})

Tabs.Main:Section({ Title = "Main" })

-- ========= Speed Lock (WindUI Version) =========
local speedCurrent, speedHumanoid = 16, nil
local speedEnforced, speedPaused = false, false
local speedStunUntil, speedSlowUntil = 0, 0
local speedTickConn = nil
local speedLastTick, speedTickInterval = 0, 0.12

local function setWalkSpeed(h, v)
    if h and h.Parent then
        pcall(function() h.WalkSpeed = v end)
    end
end

local function canEnforce()
    local h = speedHumanoid
    if not speedEnforced then return false end
    if not h or not h.Parent then return false end
    if speedPaused then return false end
    if os.clock() < speedStunUntil or os.clock() < speedSlowUntil then return false end
    if h.Health <= 0 then return false end
    if h.PlatformStand or h.Sit then return false end
    local st = h:GetState()
    if st == Enum.HumanoidStateType.Ragdoll or st == Enum.HumanoidStateType.FallingDown or st == Enum.HumanoidStateType.Physics or st == Enum.HumanoidStateType.GettingUp or st == Enum.HumanoidStateType.Seated then return false end
    local hrp = h.Parent:FindFirstChild("HumanoidRootPart")
    if hrp and hrp.Anchored then return false end
    return true
end

local function heartbeat()
    if not speedHumanoid then return end
    local t = os.clock()
    if t - speedLastTick < speedTickInterval then return end
    speedLastTick = t
    if not canEnforce() then return end
    if speedHumanoid.WalkSpeed ~= speedCurrent then
        setWalkSpeed(speedHumanoid, speedCurrent)
    end
end

local function disconnectAll()
    if speedTickConn then
        speedTickConn:Disconnect()
        speedTickConn = nil
    end
end

local function bindHumanoid(h)
    speedHumanoid = h
    if speedTickConn then speedTickConn:Disconnect() end
    speedTickConn = game:GetService("RunService").Heartbeat:Connect(heartbeat)
end

-- Bind ke Humanoid saat script dijalankan
local player = game.Players.LocalPlayer
if player.Character then
    bindHumanoid(player.Character:FindFirstChildOfClass("Humanoid"))
end
player.CharacterAdded:Connect(function(char)
    bindHumanoid(char:WaitForChild("Humanoid"))
end)

-- ========= WindUI Integration =========
Tabs.Main:Toggle({
    Title = "Enabled Speed",
    Value = false,
    Callback = function(state)
        speedEnforced = state
        local h = speedHumanoid
        if not h or not h.Parent then return end
        if state then
            if not speedTickConn then
                speedTickConn = game:GetService("RunService").Heartbeat:Connect(heartbeat)
            end
            if canEnforce() then setWalkSpeed(h, speedCurrent) end
        else
            disconnectAll()
            setWalkSpeed(h, 16) -- Reset ke default
        end
    end
})

Tabs.Main:Slider({ 
    Title = "Speed Set", 
    Step = 1, 
    Value = {
        Min = 16, 
        Max = 200, 
        Default = 16, 
    },
    Callback = function(value)
        speedCurrent = value
        if speedEnforced and canEnforce() then
            setWalkSpeed(speedHumanoid, speedCurrent)
        end
    end
})


Tabs.Main:Button({
    Title = "Reset Speed",
    Callback = function()
        speedCurrent = 16
        if speedHumanoid and speedHumanoid.Parent then
            if speedEnforced and canEnforce() then
                setWalkSpeed(speedHumanoid, speedCurrent)
            else
                setWalkSpeed(speedHumanoid, 16)
            end
        end
    end
})


-- Services
local ReplicatedStorage = game:GetService("ReplicatedStorage")

-- Remote
local PlayerActionEvent = ReplicatedStorage.Remotes.Game.PlayerActionEvent -- RemoteEvent 

-- Variabel untuk toggle
local autoRepair = false

-- Toggle di WindUI
Tabs.Main:Toggle({ 
    Title = "Auto Repaired Generator", 
    Value = false,
    Callback = function(state)
        autoRepair = state
        if state then
        else
        end
    end
})

-- Loop untuk firesignal
spawn(function()
    while true do
        if autoRepair then
            firesignal(PlayerActionEvent.OnClientEvent, "Repaired Generator", 2)
        end
        task.wait(0.1) -- delay 1 detik
    end
end)


local ReplicatedStorage = game:GetService("ReplicatedStorage")
local PlayerActionEvent = ReplicatedStorage.Remotes.Game.PlayerActionEvent -- RemoteEvent

-- Variabel kontrol
local GeneratorV2 = false

-- Toggle WindUI
Tabs.Main:Toggle({
    Title = "Generator v2",
    Value = false,
    Callback = function(state)
        GeneratorV2 = state

        task.spawn(function()
            while GeneratorV2 do
                firesignal(PlayerActionEvent.OnClientEvent, "Got Chased", 2)
                task.wait(0.1)
            end
        end)
    end
})


-- Services
local ReplicatedStorage = game:GetService("ReplicatedStorage")

-- Remote
local Phonk1 = ReplicatedStorage.Remotes.Pallet.Jason["Destroy-Global"] -- RemoteEvent 

-- Variabel kontrol
local autoDestroy = false

-- Toggle GUI
Tabs.Main:Toggle({
    Title = "Auto Destroy Global",
    Value = false,
    Callback = function(state)
        autoDestroy = state

        if state then
            task.spawn(function()
                while autoDestroy do
                    Phonk1:FireServer(PalletPointSlide)
                    task.wait(0.1) -- ubah ke 0.001 kalau mau super cepat
                end
            end)
        end
    end
})


-- Services
local ReplicatedStorage = game:GetService("ReplicatedStorage")

-- Remote
local BasicAttack = ReplicatedStorage.Remotes.Attacks.BasicAttack -- RemoteEvent 

-- Variabel kontrol
local autoAttack = false

-- Toggle GUI
Tabs.Main:Toggle({
    Title = "Auto Basic Attack",
    Value = false,
    Callback = function(state)
        autoAttack = state

        if state then
            -- Loop otomatis
            task.spawn(function()
                while autoAttack do
                    BasicAttack:FireServer()
                    task.wait(0.1) -- ganti 0.001 kalau mau super cepat
                end
            end)
        end
    end
})

-- Services
local ReplicatedStorage = game:GetService("ReplicatedStorage")

-- Remote
local hit = ReplicatedStorage.Remotes.Attacks.hit -- RemoteEvent 

-- Variabel kontrol
local autoHit = false

-- Toggle GUI
Tabs.Main:Toggle({
    Title = "Auto Hit",
    Value = false,
    Callback = function(state)
        autoHit = state

        if state then
            -- Jalankan loop di thread terpisah
            task.spawn(function()
                while autoHit do
                    firesignal(hit.OnClientEvent)
                    task.wait(0.1) -- ubah ke 0.001 kalau mau lebih cepat
                end
            end)
        end
    end
})


-- Services
local ReplicatedStorage = game:GetService("ReplicatedStorage")

-- Remote
local HookEvent = ReplicatedStorage.Remotes.Carry.HookEvent -- RemoteEvent 

-- Variabel kontrol
local autoHook = false

-- Toggle GUI
Tabs.Main:Toggle({
    Title = "Auto Hook",
    Value = false,
    Callback = function(state)
        autoHook = state

        if state then
            task.spawn(function()
                -- Tunggu sampai Map, Hook, dan HookPoint benar-benar muncul
                local Map = workspace:WaitForChild("Map")
                local HookFolder = Map:WaitForChild("Hook")
                local HookPoint = HookFolder:WaitForChild("HookPoint")

                -- Loop otomatis
                while autoHook do
                    firesignal(HookEvent.OnClientEvent, HookPoint)
                    task.wait(0.1) -- ubah ke 0.001 kalau mau super cepat
                end
            end)
        end
    end
})


Tabs.Visual:Section({ Title = "View" })

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local Camera = workspace.CurrentCamera
local LocalPlayer = Players.LocalPlayer
local PlayerGui = LocalPlayer:WaitForChild("PlayerGui")

local ESPEnabled = false
local NotifyEnabled = true
local NotifyDistance = 100
local MaxIndicatorDistance = 500 -- stud
local ESPFolder = {}
local NotifiedEnemies = {}

--// GUI utama
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "EnemyESPGui"
screenGui.ResetOnSpawn = false
screenGui.IgnoreGuiInset = true
screenGui.Parent = PlayerGui

--// Kompas bar di bawah logo Roblox (kanan atas)
local compassFrame = Instance.new("Frame")
compassFrame.Name = "CompassFrame"
compassFrame.AnchorPoint = Vector2.new(1, 0)
compassFrame.Position = UDim2.new(1, -20, 0, 60) -- pojok kanan atas, di bawah logo Roblox
compassFrame.Size = UDim2.new(0, 250, 0, 10)
compassFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
compassFrame.BackgroundTransparency = 0.5
compassFrame.BorderSizePixel = 0
compassFrame.Parent = screenGui

-- Garis tengah kompas
local compassLine = Instance.new("Frame")
compassLine.Name = "CenterLine"
compassLine.AnchorPoint = Vector2.new(0.5, 0.5)
compassLine.Position = UDim2.new(0.5, 0, 0.5, 0)
compassLine.Size = UDim2.new(0, 2, 1, 0)
compassLine.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
compassLine.Parent = compassFrame

--// Fungsi buat ESP
local function CreateESP(player)
	if player == LocalPlayer then return end
	local esp = {
		Box = Drawing.new("Square"),
		Text = Drawing.new("Text"),
		Indicator = nil, -- frame visual di kompas
	}

	esp.Box.Thickness = 1.5
	esp.Box.Filled = false
	esp.Box.Color = Color3.fromRGB(255, 255, 255)
	esp.Box.Visible = false

	esp.Text.Size = 16
	esp.Text.Center = true
	esp.Text.Outline = true
	esp.Text.Visible = false
	esp.Text.Color = Color3.fromRGB(255, 255, 255)

	ESPFolder[player] = esp
end

--// Hapus ESP
local function RemoveESP(player)
	if ESPFolder[player] then
		for _, obj in pairs(ESPFolder[player]) do
			if typeof(obj) == "Instance" then
				obj:Destroy()
			else
				obj:Remove()
			end
		end
		ESPFolder[player] = nil
	end
	NotifiedEnemies[player] = nil
end

--// Loop utama ESP
RunService.RenderStepped:Connect(function()
	if not ESPEnabled then
		for _, esp in pairs(ESPFolder) do
			for _, obj in pairs(esp) do
				if typeof(obj) == "Instance" then
					obj.Visible = false
				else
					obj.Visible = false
				end
			end
		end
		return
	end

	for _, player in pairs(Players:GetPlayers()) do
		if player ~= LocalPlayer and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
			local rootPart = player.Character.HumanoidRootPart
			local humanoid = player.Character:FindFirstChildOfClass("Humanoid")
			if humanoid and humanoid.Health > 0 then
				local vector, onScreen = Camera:WorldToViewportPoint(rootPart.Position)
				local teamColor = Color3.fromRGB(255, 255, 255)

				if player.Team and LocalPlayer.Team then
					if player.Team == LocalPlayer.Team then
						teamColor = Color3.fromRGB(0, 255, 0)
					else
						teamColor = Color3.fromRGB(255, 0, 0)
					end
				end

				local distance = (rootPart.Position - LocalPlayer.Character.HumanoidRootPart.Position).Magnitude
				local health = math.floor(humanoid.Health)

				-- Notifikasi musuh dekat
				if NotifyEnabled and player.Team ~= LocalPlayer.Team and distance <= NotifyDistance then
					if not NotifiedEnemies[player] then
						NotifiedEnemies[player] = true
						task.spawn(function()
							WindUI:Notify({
								Title = "âš ï¸ Musuh Dekat!",
								Content = player.Name .. " dalam jarak " .. math.floor(distance) .. " stud!",
								Icon = "slice",
								Duration = 1,
							})
							task.wait(10)
							NotifiedEnemies[player] = nil
						end)
					end
				end

				local esp = ESPFolder[player]
				if not esp then continue end

				-- ESP box layar
				if onScreen then
					local scale = 1 / (vector.Z * 0.1)
					local boxSize = Vector2.new(150 * scale, 200 * scale)
					esp.Box.Size = boxSize
					esp.Box.Position = Vector2.new(vector.X - boxSize.X / 2, vector.Y - boxSize.Y / 2)
					esp.Box.Color = teamColor
					esp.Box.Visible = true

					esp.Text.Position = Vector2.new(vector.X, vector.Y - boxSize.Y / 2 - 15)
					esp.Text.Color = teamColor
					esp.Text.Text = string.format("%s | %d HP | %d Stud", player.Name, health, distance)
					esp.Text.Visible = true
				else
					esp.Box.Visible = false
					esp.Text.Visible = false
				end

				-- Kompas arah musuh (pakai Frame)
				if player.Team ~= LocalPlayer.Team and distance <= MaxIndicatorDistance then
					local relative = (rootPart.Position - LocalPlayer.Character.HumanoidRootPart.Position).Unit
					local lookVector = Camera.CFrame.LookVector
					local right = Camera.CFrame.RightVector:Dot(relative)
					local forward = Camera.CFrame.LookVector:Dot(relative)
					local angle = math.atan2(right, forward)
					local normalizedAngle = math.deg(angle) / 90 -- -1..1
					local posX = (normalizedAngle * (compassFrame.AbsoluteSize.X / 2))

					local indicator = esp.Indicator
					if not indicator or not indicator.Parent then
						local frame = Instance.new("Frame")
						frame.Name = player.Name .. "_Indicator"
						frame.AnchorPoint = Vector2.new(0.5, 0.5)
						frame.Size = UDim2.new(0, 6, 0, 10)
						frame.BorderSizePixel = 0
						frame.BackgroundColor3 = Color3.fromRGB(255, 50, 50)
						frame.Parent = compassFrame
						esp.Indicator = frame
						indicator = frame
					end

					indicator.Visible = true
					indicator.Position = UDim2.new(0.5, posX, 0.5, 0)
					indicator.BackgroundColor3 = Color3.fromRGB(
						math.clamp(255 - distance / MaxIndicatorDistance * 100, 150, 255),
						math.clamp(50 + distance / MaxIndicatorDistance * 100, 50, 150),
						50
					)
					indicator.BackgroundTransparency = math.clamp(distance / MaxIndicatorDistance, 0, 0.6)
				else
					if esp.Indicator and esp.Indicator:IsA("Frame") then
						esp.Indicator.Visible = false
					end
				end
			else
				local esp = ESPFolder[player]
				if esp then
					esp.Box.Visible = false
					esp.Text.Visible = false
					if esp.Indicator and esp.Indicator:IsA("Frame") then
						esp.Indicator.Visible = false
					end
				end
			end
		end
	end
end)

--// Player join/leave
Players.PlayerAdded:Connect(CreateESP)
Players.PlayerRemoving:Connect(RemoveESP)
for _, p in pairs(Players:GetPlayers()) do
	CreateESP(p)
end

--// Toggle ESP
Tabs.Visual:Toggle({
	Title = "ESP (Team & Killer)",
	Value = false,
	Callback = function(state)
		ESPEnabled = state
	end
})

--// Toggle Notify
Tabs.Visual:Toggle({
	Title = "Notify Killer Nearby",
	Value = true,
	Callback = function(state)
		NotifyEnabled = state
	end
})


Tabs.Visual:Toggle({
    Title = "View Generator",
    Default = false,
    Callback = function(state)
        local map = workspace:FindFirstChild("Map")
        if not map then return end

        -- hentikan loop lama
        if getgenv().ViewGeneratorLoop then
            getgenv().ViewGeneratorLoop = nil
        end

        if state then
            getgenv().ViewGeneratorLoop = true

            task.spawn(function()
                while getgenv().ViewGeneratorLoop do
                    for _, generator in pairs(map:GetChildren()) do
                        if string.find(generator.Name, "Generator") then
                            local point1 = generator:FindFirstChild("GeneratorPoint1")
                            local point2 = generator:FindFirstChild("GeneratorPoint2")
                            local point3 = generator:FindFirstChild("GeneratorPoint3")

                            -- kalau salah satu point ada, generator off
                            local isOff = (point1 or point2 or point3) ~= nil
                            local color = isOff and Color3.fromRGB(255, 0, 0) or Color3.fromRGB(0, 255, 0)

                            -- cari part untuk tempat gui
                            local adorneePart = point1 or point2 or point3 or generator:FindFirstChildWhichIsA("BasePart")
                            if adorneePart then
                                local gui = adorneePart:FindFirstChild("StatusGui")
                                if not gui then
                                    gui = Instance.new("BillboardGui")
                                    gui.Name = "StatusGui"
                                    gui.Adornee = adorneePart
                                    gui.Size = UDim2.new(0, 100, 0, 50)
                                    gui.StudsOffset = Vector3.new(0, 3, 0)
                                    gui.AlwaysOnTop = true
                                    gui.Parent = adorneePart

                                    local label = Instance.new("TextLabel")
                                    label.Size = UDim2.new(1, 0, 1, 0)
                                    label.BackgroundTransparency = 1
                                    label.TextScaled = true
                                    label.Font = Enum.Font.GothamBlack
                                    label.Text = "!"
                                    label.Parent = gui
                                end

                                gui.TextLabel.TextColor3 = color
                            end
                        end
                    end
                    task.wait(1)
                end
            end)

        else
            getgenv().ViewGeneratorLoop = nil

            -- hapus semua gui status
            for _, generator in pairs(map:GetChildren()) do
                if string.find(generator.Name, "Generator") then
                    for _, gui in pairs(generator:GetDescendants()) do
                        if gui:IsA("BillboardGui") and gui.Name == "StatusGui" then
                            gui:Destroy()
                        end
                    end
                end
            end
        end
    end
})

-------------------------------------------------------
-- TOGGLE BUTTON (PUTIH AGAK TRANSPARAN) + ANIMASI BARU
-- by HDragons (WindUI Support)
-------------------------------------------------------
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")

-------------------------------------------------------
-- GUI BUTTON
-------------------------------------------------------
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "WindUIButton"
ScreenGui.ResetOnSpawn = false
ScreenGui.IgnoreGuiInset = true
ScreenGui.Parent = game.CoreGui

local ImgBtn = Instance.new("ImageButton")
ImgBtn.Parent = ScreenGui
ImgBtn.Size = UDim2.new(0, 60, 0, 60)
ImgBtn.Position = UDim2.new(0, 100, 1, -250)
ImgBtn.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
ImgBtn.BackgroundTransparency = 0.3
ImgBtn.Image = "rbxassetid://131269662643486" -- icon planet
ImgBtn.ImageTransparency = 0.1
ImgBtn.ImageColor3 = Color3.fromRGB(255, 255, 255)
ImgBtn.AutoButtonColor = false

local UICorner = Instance.new("UICorner", ImgBtn)
UICorner.CornerRadius = UDim.new(1, 0)

local UIStroke = Instance.new("UIStroke", ImgBtn)
UIStroke.Color = Color3.fromRGB(200, 200, 200)
UIStroke.Thickness = 2
UIStroke.Transparency = 0.4
UIStroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border

-------------------------------------------------------
-- EFEK HOVER (Glow halus)
-------------------------------------------------------
ImgBtn.MouseEnter:Connect(function()
	TweenService:Create(ImgBtn, TweenInfo.new(0.2), {
		BackgroundTransparency = 0.15
	}):Play()
	TweenService:Create(UIStroke, TweenInfo.new(0.2), {
		Transparency = 0.1
	}):Play()
end)

ImgBtn.MouseLeave:Connect(function()
	TweenService:Create(ImgBtn, TweenInfo.new(0.3), {
		BackgroundTransparency = 0.3
	}):Play()
	TweenService:Create(UIStroke, TweenInfo.new(0.3), {
		Transparency = 0.4
	}):Play()
end)

-------------------------------------------------------
-- ANIMASI KLIK (shrink + pulse)
-------------------------------------------------------
local function playClickAnim()
	local shrink = TweenService:Create(ImgBtn, TweenInfo.new(0.1, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
		Size = UDim2.new(0, 52, 0, 52)
	})
	local grow = TweenService:Create(ImgBtn, TweenInfo.new(0.25, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {
		Size = UDim2.new(0, 60, 0, 60)
	})
	shrink:Play()
	shrink.Completed:Wait()
	grow:Play()
end

-------------------------------------------------------
-- ANIMASI WINDOW OPEN/CLOSE (Fade + Slide)
-------------------------------------------------------
local function animateWindowOpen(windowFrame)
	if not windowFrame then return end
	windowFrame.Visible = true
	windowFrame.BackgroundTransparency = 1
	windowFrame.Position = windowFrame.Position + UDim2.new(0, 0, 0.05, 0)

	TweenService:Create(windowFrame, TweenInfo.new(0.3, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
		BackgroundTransparency = 0,
		Position = windowFrame.Position - UDim2.new(0, 0, 0.05, 0)
	}):Play()
end

local function animateWindowClose(windowFrame)
	if not windowFrame then return end
	local tween = TweenService:Create(windowFrame, TweenInfo.new(0.25, Enum.EasingStyle.Quad, Enum.EasingDirection.In), {
		BackgroundTransparency = 1,
		Position = windowFrame.Position + UDim2.new(0, 0, 0.05, 0)
	})
	tween:Play()
	tween.Completed:Wait()
	windowFrame.Visible = false
end

-------------------------------------------------------
-- SISTEM TOGGLE WINDUI
-------------------------------------------------------
local isOpen = true
local debounce = false

ImgBtn.MouseButton1Click:Connect(function()
	if debounce then return end
	debounce = true
	playClickAnim()

	task.defer(function()
		if Window and Window.Open and Window.Close then
			local guiFrame = Window.GUI or Window.Frame or Window.MainFrame

			if isOpen then
				animateWindowClose(guiFrame)
				Window:Close()
			else
				Window:Open()
				animateWindowOpen(guiFrame)
			end
			isOpen = not isOpen
		else
			warn("âš ï¸ WindUI belum siap! Pastikan variabel 'Window' sudah dibuat.")
		end

		task.wait(0.3)
		debounce = false
	end)
end)

-------------------------------------------------------
-- DRAGGING SUPPORT
-------------------------------------------------------
local dragging, dragInput, dragStart, startPos

local function update(input)
	local delta = input.Position - dragStart
	ImgBtn.Position = UDim2.new(
		startPos.X.Scale, startPos.X.Offset + delta.X,
		startPos.Y.Scale, startPos.Y.Offset + delta.Y
	)
end

ImgBtn.InputBegan:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
		dragging = true
		dragStart = input.Position
		startPos = ImgBtn.Position

		input.Changed:Connect(function()
			if input.UserInputState == Enum.UserInputState.End then
				dragging = false
			end
		end)
	end
end)

ImgBtn.InputChanged:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
		dragInput = input
	end
end)

UserInputService.InputChanged:Connect(function(input)
	if input == dragInput and dragging then
		update(input)
	end
end)
