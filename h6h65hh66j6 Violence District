local map = workspace:WaitForChild("Map")

-- Fungsi rename generator
local function renameGenerators()
	local count = 0
	for _, obj in ipairs(map:GetChildren()) do
		if obj:IsA("Model") and string.find(obj.Name, "Generator") then
			count += 1
			obj.Name = "Generator " .. count
		end
	end
end

-- Jalankan saat pertama kali
renameGenerators()

-- Kalau ada model Generator baru ditambahkan ke Map
map.ChildAdded:Connect(function(child)
	task.wait(0.5)
	if child:IsA("Model") and string.find(child.Name, "Generator") then
		renameGenerators()
	end
end)



local WindUI = loadstring(game:HttpGet("https://github.com/Footagesus/WindUI/releases/latest/download/main.lua"))()

-- Ambil nama player
local player = game.Players.LocalPlayer
local playerName = player.Name
local playerDisplayName = player.DisplayName

-- Buat Window
local Window = WindUI:CreateWindow({
    Title = "Nexa - Premium",
    Icon = "rbxassetid://131269662643486",
    Author = "Violence District Script | @ Han",
    Folder = "Hanzo",
    Size = UDim2.fromOffset(650, 510),

    Theme = "Plant",
    Transparent = true,
    Acrylic = false,
    HidePanelBackground = true,
    HideSearchBar = false,
    NewElements = true,
    SideBarWidth = 200,

    -- Profil user di pojok kanan atas
    User = {
        Enabled = true,
        Anonymous = false,
        Name = playerDisplayName,
        UserName = "@" .. playerName,
        Callback = function()
            WindUI:Notify({
                Title = "User Profile",
                Content = "User profile clicked!",
                Duration = 3
            })
        end
    }
})

Window:Tag({
    Title = "v1.2.9",
    Color = Color3.fromHex("#30ff6a")
})


Window:EditOpenButton({
    Enabled = false
})

local Tabs = {
    Home = Window:Tab({ Title = "Home", Icon = "house"  }),
    Main = Window:Tab({ Title = "Main", Icon = "swords"  }),
}

Tabs.Home:Section({ Title = "Update", Icon = "logs" })

Tabs.Home:Section({
        Title = "Here's what's new:",
        TextSize = 24,
        FontWeight = Enum.FontWeight.SemiBold,
    })

Tabs.Home:Section({
        Title = [[

		]],
        TextSize = 18,
        TextTransparency = .35,
        FontWeight = Enum.FontWeight.Medium,
    })

Tabs.Home:Section({ Title = "Server" })

Tabs.Home:Paragraph({
    Title = "Nexa Hub",
    Image = "https://i.imgur.com/vl0g8IK.png",
    ImageSize = 42, -- default 30
    Thumbnail = "https://i.imgur.com/3m8FV2y.jpeg",
    ThumbnailSize = 120 -- Thumbnail height
})

Tabs.Home:Paragraph({
    Title = "Discord - Nexa | COMMUNITY",
    Desc = "Indonesia 🇮🇩",
    Image = "https://images-eds-ssl.xboxlive.com/image?url=4rt9.lXDC4H_93laV1_eHHFT949fUipzkiFOBH3fAiZZUCdYojwUyX2aTonS1aIwMrx6NUIsHfUHSLzjGJFxxsG72wAo9EWJR4yQWyJJaDaK1XdUso6cUMpI9hAdPUU_FNs11cY1X284vsHrnWtRw7oqRpN1m9YAg21d_aNKnIo-&format=source",
    ImageSize = 40,
    Color = "Grey",
    Buttons = {
        {
            Title = "Copy Link",
            Icon = "copy",
            Variant = "Tertiary",
            Callback = function()
                setclipboard("discord.gg/ECxQFc97F5")
                WindUI:Notify({
                    Title = "Copied!",
                    Content = "Discord link copied to clipboard",
                    Duration = 2
                })
            end
        }
    }
})

Tabs.Main:Section({ Title = "Main" })

--// ESP Player by Team + HP + Distance + WindUI Notify (Icon Style)
--// Made by ChatGPT (GPT-5)

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local Camera = workspace.CurrentCamera
local LocalPlayer = Players.LocalPlayer

local ESPEnabled = false
local NotifyEnabled = true
local NotifyDistance = 150 -- stud
local ESPFolder = {}
local NotifiedEnemies = {}

--// Buat ESP player
local function CreateESP(player)
    if player == LocalPlayer then return end
    local esp = {
        Box = Drawing.new("Square"),
        Text = Drawing.new("Text")
    }

    esp.Box.Thickness = 1.5
    esp.Box.Filled = false
    esp.Box.Color = Color3.fromRGB(255, 255, 255)
    esp.Box.Visible = false

    esp.Text.Size = 16
    esp.Text.Center = true
    esp.Text.Outline = true
    esp.Text.Visible = false
    esp.Text.Color = Color3.fromRGB(255, 255, 255)

    ESPFolder[player] = esp
end

--// Hapus ESP player
local function RemoveESP(player)
    if ESPFolder[player] then
        for _, obj in pairs(ESPFolder[player]) do
            obj:Remove()
        end
        ESPFolder[player] = nil
    end
    NotifiedEnemies[player] = nil
end

--// Loop utama ESP
RunService.RenderStepped:Connect(function()
    if not ESPEnabled then
        for _, esp in pairs(ESPFolder) do
            for _, obj in pairs(esp) do
                obj.Visible = false
            end
        end
        return
    end

    for _, player in pairs(Players:GetPlayers()) do
        if player ~= LocalPlayer and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
            local rootPart = player.Character.HumanoidRootPart
            local humanoid = player.Character:FindFirstChildOfClass("Humanoid")
            if humanoid and humanoid.Health > 0 then
                local vector, onScreen = Camera:WorldToViewportPoint(rootPart.Position)

                local teamColor = Color3.fromRGB(255, 255, 255)
                if player.Team and LocalPlayer.Team then
                    if player.Team == LocalPlayer.Team then
                        teamColor = Color3.fromRGB(0, 255, 0) -- hijau = teman
                    else
                        teamColor = Color3.fromRGB(255, 0, 0) -- merah = musuh
                    end
                end

                local distance = (rootPart.Position - LocalPlayer.Character.HumanoidRootPart.Position).Magnitude
                local health = math.floor(humanoid.Health)

                -- Notifikasi musuh dekat pakai WindUI (dengan Icon)
                if NotifyEnabled and player.Team ~= LocalPlayer.Team and distance <= NotifyDistance then
                    if not NotifiedEnemies[player] then
                        NotifiedEnemies[player] = true
                        task.spawn(function()
                            WindUI:Notify({
                                Title = "🔪 Killer Dekat!",
                                Content = player.Name .. " dalam jarak " .. math.floor(distance) .. " stud! Berhati Hati lah",
                                Icon = "slice",
                                Duration = 1,
                            })
                            task.wait(10)
                            NotifiedEnemies[player] = nil
                        end)
                    end
                end

                if onScreen then
                    local esp = ESPFolder[player]
                    local scale = 1 / (vector.Z * 0.1)
                    local boxSize = Vector2.new(150 * scale, 200 * scale)

                    -- Box ESP
                    esp.Box.Size = boxSize
                    esp.Box.Position = Vector2.new(vector.X - boxSize.X / 2, vector.Y - boxSize.Y / 2)
                    esp.Box.Color = teamColor
                    esp.Box.Visible = true

                    -- Text (Nama | HP | Jarak)
                    esp.Text.Position = Vector2.new(vector.X, vector.Y - boxSize.Y / 2 - 15)
                    esp.Text.Color = teamColor
                    esp.Text.Text = string.format("%s | %d HP | %d Stud", player.Name, health, distance)
                    esp.Text.Visible = true
                else
                    local esp = ESPFolder[player]
                    esp.Box.Visible = false
                    esp.Text.Visible = false
                end
            else
                local esp = ESPFolder[player]
                esp.Box.Visible = false
                esp.Text.Visible = false
            end
        end
    end
end)

--// Player join/leave handler
Players.PlayerAdded:Connect(CreateESP)
Players.PlayerRemoving:Connect(RemoveESP)
for _, p in pairs(Players:GetPlayers()) do
    CreateESP(p)
end

--// WindUI Toggle ESP utama
Tabs.Main:Toggle({
    Title = "ESP (Team & Killer)",
    Value = false,
    Callback = function(state)
        ESPEnabled = state
    end
})

--// WindUI Toggle Notifikasi musuh dekat
Tabs.Main:Toggle({
    Title = "Notify Musuh Dekat",
    Value = true,
    Callback = function(state)
        NotifyEnabled = state
    end
})


Tabs.Main:Toggle({
    Title = "View Generator",
    Default = false,
    Callback = function(state)
        local map = workspace:FindFirstChild("Map")
        if not map then return end

        -- hentikan loop sebelumnya kalau ada
        if getgenv().ViewGeneratorLoop then
            getgenv().ViewGeneratorLoop = nil
        end

        if state then
            getgenv().ViewGeneratorLoop = true

            task.spawn(function()
                while getgenv().ViewGeneratorLoop do
                    for _, generator in pairs(map:GetChildren()) do
                        if string.find(generator.Name, "Generator") then
                            local point = generator:FindFirstChild("GeneratorPoint1")
                            local isOff = point ~= nil
                            local color = isOff and Color3.fromRGB(255, 0, 0) or Color3.fromRGB(0, 255, 0)

                            -- cari part untuk BillboardGui
                            local adorneePart = point or generator:FindFirstChildWhichIsA("BasePart")
                            if adorneePart then
                                local gui = adorneePart:FindFirstChild("StatusGui")
                                if not gui then
                                    gui = Instance.new("BillboardGui")
                                    gui.Name = "StatusGui"
                                    gui.Adornee = adorneePart
                                    gui.Size = UDim2.new(0, 100, 0, 50)
                                    gui.StudsOffset = Vector3.new(0, 3, 0)
                                    gui.AlwaysOnTop = true
                                    gui.Parent = adorneePart

                                    local label = Instance.new("TextLabel")
                                    label.Size = UDim2.new(1, 0, 1, 0)
                                    label.BackgroundTransparency = 1
                                    label.TextScaled = true
                                    label.Font = Enum.Font.GothamBlack
                                    label.Text = "!"
                                    label.Parent = gui
                                end

                                gui.TextLabel.TextColor3 = color
                            end
                        end
                    end
                    task.wait(1) -- update tiap 1 detik
                end
            end)

        else
            getgenv().ViewGeneratorLoop = nil

            -- hapus semua status gui
            for _, generator in pairs(map:GetChildren()) do
                if string.find(generator.Name, "Generator") then
                    for _, gui in pairs(generator:GetDescendants()) do
                        if gui:IsA("BillboardGui") and gui.Name == "StatusGui" then
                            gui:Destroy()
                        end
                    end
                end
            end
        end
    end
})

-- Services
local ReplicatedStorage = game:GetService("ReplicatedStorage")

-- Remote
local PlayerActionEvent = ReplicatedStorage.Remotes.Game.PlayerActionEvent -- RemoteEvent 

-- Variabel untuk toggle
local autoRepair = false

-- Toggle di WindUI
Tabs.Main:Toggle({ 
    Title = "Auto Repaired Generator", 
    Value = false,
    Callback = function(state)
        autoRepair = state
        if state then
        else
        end
    end
})

-- Loop untuk firesignal
spawn(function()
    while true do
        if autoRepair then
            firesignal(PlayerActionEvent.OnClientEvent, "Repaired Generator", 2)
        end
        task.wait(0.01) -- delay 1 detik
    end
end)

local ReplicatedStorage = game:GetService("ReplicatedStorage")
local PlayerActionEvent = ReplicatedStorage.Remotes.Game.PlayerActionEvent -- RemoteEvent

-- Variabel kontrol
local GeneratorV2 = false

-- Toggle WindUI
Tabs.Main:Toggle({
    Title = "Generator v2",
    Value = false,
    Callback = function(state)
        GeneratorV2 = state

        task.spawn(function()
            while GeneratorV2 do
                firesignal(PlayerActionEvent.OnClientEvent, "Got Chased", 2)
                task.wait(0.01)
            end
        end)
    end
})

-------------------------------------------------------
-- TOGGLE BUTTON (PUTIH AGAK TRANSPARAN) + ANIMASI BARU
-- by HDragons (WindUI Support)
-------------------------------------------------------
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")

-------------------------------------------------------
-- GUI BUTTON
-------------------------------------------------------
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "WindUIButton"
ScreenGui.ResetOnSpawn = false
ScreenGui.IgnoreGuiInset = true
ScreenGui.Parent = game.CoreGui

local ImgBtn = Instance.new("ImageButton")
ImgBtn.Parent = ScreenGui
ImgBtn.Size = UDim2.new(0, 60, 0, 60)
ImgBtn.Position = UDim2.new(0, 100, 1, -250)
ImgBtn.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
ImgBtn.BackgroundTransparency = 0.3
ImgBtn.Image = "rbxassetid://131269662643486" -- icon planet
ImgBtn.ImageTransparency = 0.1
ImgBtn.ImageColor3 = Color3.fromRGB(255, 255, 255)
ImgBtn.AutoButtonColor = false

local UICorner = Instance.new("UICorner", ImgBtn)
UICorner.CornerRadius = UDim.new(1, 0)

local UIStroke = Instance.new("UIStroke", ImgBtn)
UIStroke.Color = Color3.fromRGB(200, 200, 200)
UIStroke.Thickness = 2
UIStroke.Transparency = 0.4
UIStroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border

-------------------------------------------------------
-- EFEK HOVER (Glow halus)
-------------------------------------------------------
ImgBtn.MouseEnter:Connect(function()
	TweenService:Create(ImgBtn, TweenInfo.new(0.2), {
		BackgroundTransparency = 0.15
	}):Play()
	TweenService:Create(UIStroke, TweenInfo.new(0.2), {
		Transparency = 0.1
	}):Play()
end)

ImgBtn.MouseLeave:Connect(function()
	TweenService:Create(ImgBtn, TweenInfo.new(0.3), {
		BackgroundTransparency = 0.3
	}):Play()
	TweenService:Create(UIStroke, TweenInfo.new(0.3), {
		Transparency = 0.4
	}):Play()
end)

-------------------------------------------------------
-- ANIMASI KLIK (shrink + pulse)
-------------------------------------------------------
local function playClickAnim()
	local shrink = TweenService:Create(ImgBtn, TweenInfo.new(0.1, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
		Size = UDim2.new(0, 52, 0, 52)
	})
	local grow = TweenService:Create(ImgBtn, TweenInfo.new(0.25, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {
		Size = UDim2.new(0, 60, 0, 60)
	})
	shrink:Play()
	shrink.Completed:Wait()
	grow:Play()
end

-------------------------------------------------------
-- ANIMASI WINDOW OPEN/CLOSE (Fade + Slide)
-------------------------------------------------------
local function animateWindowOpen(windowFrame)
	if not windowFrame then return end
	windowFrame.Visible = true
	windowFrame.BackgroundTransparency = 1
	windowFrame.Position = windowFrame.Position + UDim2.new(0, 0, 0.05, 0)

	TweenService:Create(windowFrame, TweenInfo.new(0.3, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
		BackgroundTransparency = 0,
		Position = windowFrame.Position - UDim2.new(0, 0, 0.05, 0)
	}):Play()
end

local function animateWindowClose(windowFrame)
	if not windowFrame then return end
	local tween = TweenService:Create(windowFrame, TweenInfo.new(0.25, Enum.EasingStyle.Quad, Enum.EasingDirection.In), {
		BackgroundTransparency = 1,
		Position = windowFrame.Position + UDim2.new(0, 0, 0.05, 0)
	})
	tween:Play()
	tween.Completed:Wait()
	windowFrame.Visible = false
end

-------------------------------------------------------
-- SISTEM TOGGLE WINDUI
-------------------------------------------------------
local isOpen = true
local debounce = false

ImgBtn.MouseButton1Click:Connect(function()
	if debounce then return end
	debounce = true
	playClickAnim()

	task.defer(function()
		if Window and Window.Open and Window.Close then
			local guiFrame = Window.GUI or Window.Frame or Window.MainFrame

			if isOpen then
				animateWindowClose(guiFrame)
				Window:Close()
			else
				Window:Open()
				animateWindowOpen(guiFrame)
			end
			isOpen = not isOpen
		else
			warn("⚠️ WindUI belum siap! Pastikan variabel 'Window' sudah dibuat.")
		end

		task.wait(0.3)
		debounce = false
	end)
end)

-------------------------------------------------------
-- DRAGGING SUPPORT
-------------------------------------------------------
local dragging, dragInput, dragStart, startPos

local function update(input)
	local delta = input.Position - dragStart
	ImgBtn.Position = UDim2.new(
		startPos.X.Scale, startPos.X.Offset + delta.X,
		startPos.Y.Scale, startPos.Y.Offset + delta.Y
	)
end

ImgBtn.InputBegan:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
		dragging = true
		dragStart = input.Position
		startPos = ImgBtn.Position

		input.Changed:Connect(function()
			if input.UserInputState == Enum.UserInputState.End then
				dragging = false
			end
		end)
	end
end)

ImgBtn.InputChanged:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
		dragInput = input
	end
end)

UserInputService.InputChanged:Connect(function(input)
	if input == dragInput and dragging then
		update(input)
	end
end)

