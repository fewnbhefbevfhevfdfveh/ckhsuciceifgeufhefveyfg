local MacLib = loadstring(game:HttpGet("https://github.com/biggaboy212/Maclib/releases/latest/download/maclib.txt"))()

-- Deklarasi service dan variabel utama (tidak diubah) jangan di ubah ubah sama sekali
local workspace = workspace
local Players = game:GetService("Players")
local player = Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local hrp = character:WaitForChild("HumanoidRootPart")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local RunService = game:GetService("RunService")
local LocalPlayer = player -- alias supaya sama dengan LocalPlayer

local camera = workspace.CurrentCamera
local screenSize = camera.ViewportSize

local Window = MacLib:Window({
    Title = "Nexa | Premium",
    Subtitle = "Fish It | V0.0.1",
    Size = UDim2.fromOffset(720, 410),
    DragStyle = 1,
    DisabledWindowControls = {},
    ShowUserInfo = false,
    Keybind = Enum.KeyCode.RightControl,
    AcrylicBlur = true,
})

local cg = game:GetService("CoreGui")

task.spawn(function()
    while true do
        for _, obj in ipairs(cg:GetDescendants()) do
            if obj.Name == "UserInfo" then
                obj:Destroy()
            end
        end
        task.wait(1)
    end
end)

local tabGroups = {
	TabGroup1 = Window:TabGroup()
}

local tabs = {
	Fishing = tabGroups.TabGroup1:Tab({ Name = "Fishing", Image = "rbxassetid://97899956724998" }),
	Quest = tabGroups.TabGroup1:Tab({ Name = "Quest", Image = "rbxassetid://70719631016787" }),
    Auto = tabGroups.TabGroup1:Tab({ Name = "Automatic", Image = "rbxassetid://100691400534443" }),
	Shop = tabGroups.TabGroup1:Tab({ Name = "Shop", Image = "rbxassetid://134257769519180" }),
	Boat = tabGroups.TabGroup1:Tab({ Name = "Boat", Image = "rbxassetid://79620448065359" }),
    Tp = tabGroups.TabGroup1:Tab({ Name = "Teleport", Image = "rbxassetid://124499210049583" }),
	Player = tabGroups.TabGroup1:Tab({ Name = "Player", Image = "rbxassetid://105274848905298" }),
	Config = tabGroups.TabGroup1:Tab({ Name = "Config", Image = "rbxassetid://111411260968321" }),
}
local sections = {
	Fishing = tabs.Fishing:Section({ Side = "Left" }),
    Fishing1 = tabs.Fishing:Section({ Side = "Right" }),
    Quest = tabs.Quest:Section({ Side = "Left" }),
    Quest1 = tabs.Quest:Section({ Side = "Right" }),
    Auto = tabs.Auto:Section({ Side = "Left" }),
    Auto1 = tabs.Auto:Section({ Side = "Right" }),
}

sections.Fishing:Header({
	Name = "Fishing Feature"
})

local FishingController = require(ReplicatedStorage.Controllers.FishingController)
local AutoFishingController = require(ReplicatedStorage.Controllers.AutoFishingController)
local Replion = require(ReplicatedStorage.Packages.Replion)

-- STATE
local AutoFishState = {
	IsActive = false,
	MinigameActive = false
}

local ClickSpeed = 0.05

-- CLICK FUNCTION
local function performClick()
	FishingController:RequestFishingMinigameClick()
	task.wait(ClickSpeed + math.random() * ClickSpeed)
end

-- FORCE AUTOFISH ALWAYS ON
local originalAutoFishingStateChanged = AutoFishingController.AutoFishingStateChanged
AutoFishingController.AutoFishingStateChanged = function(...)
	return originalAutoFishingStateChanged(true)
end

-- FORCE SERVER AUTO FISHING ON
local function ensureServerAutoFishingOn()
	local replionData = Replion.Client:WaitReplion("Data")
	local currentAutoFishingState = replionData:GetExpect("AutoFishing")

	if not currentAutoFishingState then
		local Net = require(ReplicatedStorage.Packages.Net)
		local UpdateAutoFishingRemote = Net:RemoteFunction("UpdateAutoFishingState")

		pcall(function()
			UpdateAutoFishingRemote:InvokeServer(true)
		end)
	end
end

-- HOOK MINIGAME
local originalRodStarted = FishingController.FishingRodStarted
local originalFishingStopped = FishingController.FishingStopped

local clickThread = nil

FishingController.FishingRodStarted = function(self, ...)
	originalRodStarted(self, ...)

	if AutoFishState.IsActive and not AutoFishState.MinigameActive then
		AutoFishState.MinigameActive = true

		if clickThread then task.cancel(clickThread) end

		clickThread = task.spawn(function()
			while AutoFishState.IsActive and AutoFishState.MinigameActive do
				performClick()
			end
		end)
	end
end

FishingController.FishingStopped = function(self, ...)
	originalFishingStopped(self, ...)

	if AutoFishState.MinigameActive then
		AutoFishState.MinigameActive = false
		task.wait(1)
		ensureServerAutoFishingOn()
	end
end

-- TOGGLE
local function ToggleAutoClick(shouldActivate)
	AutoFishState.IsActive = shouldActivate

	if shouldActivate then
		ensureServerAutoFishingOn()
	else
		if clickThread then
			task.cancel(clickThread)
			clickThread = nil
		end

		AutoFishState.MinigameActive = false
	end
end

-- =====================================================================
--  UI (FORMAT BARU)
-- =====================================================================

sections.Fishing:Toggle({
	Name = "Auto Fish Legit",
	Default = false,
	Callback = function(value)
		ToggleAutoClick(value)

		Window:Notify({
			Title = "Auto Fish Legit",
			Description = (value and "Enabled " or "Disabled ") .. "Auto Fish"
		})
	end,
}, "AutoFishToggle")

sections.Fishing:Input({
	Name = "Click Speed",
	Placeholder = "Default: 0.05",
	AcceptedCharacters = "Numbers",
	Callback = function(value)
		local num = tonumber(value)

		if num and num > 0 then
			ClickSpeed = num
			Window:Notify({
				Title = "Speed",
				Description = "Click Speed set to: " .. num
			})
		end
	end,
}, "AutoFishSpeed")

sections.Fishing:Toggle({
	Name = "Show Fishing Counter Gui",
	Default = false,
	Callback = function(state)
		local fishingCounterGui = player.PlayerGui:FindFirstChild("FishingCounterGui")

		if fishingCounterGui then
			fishingCounterGui.Enabled = state
		else
			warn("FishingCounterGui not found!")
		end
	end,
}, "ShowFishingCounterGuiToggle")

local stopAnimConnections = {}

local function setGameAnimationsEnabled(state)
    local character = player.Character or player.CharacterAdded:Wait()
    local humanoid = character:FindFirstChildOfClass("Humanoid")
    if not humanoid then
        return
    end

    -- Bersihkan koneksi animasi lama
    for _, conn in ipairs(stopAnimConnections) do
        conn:Disconnect()
    end
    stopAnimConnections = {}

    if state then
        -- Hentikan semua animasi yg sedang berjalan
        local animator = humanoid:FindFirstChildOfClass("Animator")
        if animator then
            for _, track in ipairs(animator:GetPlayingAnimationTracks()) do
                track:Stop(0)
            end

            -- Cegah animasi baru dimainkan
            local conn = animator.AnimationPlayed:Connect(function(track)
                task.defer(function()
                    track:Stop(0)
                end)
            end)
            table.insert(stopAnimConnections, conn)
        end
    else
        -- Re-enable: cukup matikan koneksi
        for _, conn in ipairs(stopAnimConnections) do
            conn:Disconnect()
        end
        stopAnimConnections = {}
    end

    -- Notify WindUI
    Window:Notify({
        Title = "No Animation",
        Description = (state and "Enabled " or "Disabled ") .. "No Animation"
    })
end

-- =====================================================================
-- Toggle WindUI (Format Baru)
-- =====================================================================

sections.Fishing:Toggle({
    Name = "No Animation",
    Default = false,
    Callback = function(state)
        setGameAnimationsEnabled(state)
    end,
})

-- Ambil RemoteFunction CancelFishing
local CancelFishing = ReplicatedStorage
    :WaitForChild("Packages")
    :WaitForChild("_Index")
    :WaitForChild("sleitnick_net@0.2.0")
    :WaitForChild("net")
    :WaitForChild("RF/CancelFishingInputs")

-- Button Baru Format sections.Fishing
sections.Fishing:Button({
	Name = "Cancel Fishing",
	Callback = function()
		CancelFishing:InvokeServer()
	end,
})


sections.Fishing:Header({
	Name = "Instant Fishing Feature"
})

-- Services (Players & ReplicatedStorage sudah didefinisikan tadi)
local Character = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()

-- Remotes
local ChargeFishingRod = ReplicatedStorage.Packages._Index["sleitnick_net@0.2.0"].net["RF/ChargeFishingRod"]
local RequestFishingMinigameStarted = ReplicatedStorage.Packages._Index["sleitnick_net@0.2.0"].net["RF/RequestFishingMinigameStarted"]
local REReplicateTextEffect = ReplicatedStorage.Packages._Index["sleitnick_net@0.2.0"].net["RE/ReplicateTextEffect"]
local REFishingCompleted = ReplicatedStorage.Packages._Index["sleitnick_net@0.2.0"].net["RE/FishingCompleted"]

-- Step 2 args
local miniggameArgs = {
    -1.233184814453125,
    0.9972056628181873,
    1763291794.158201
}

-- Flags
local isFishing = false
local autoFishingEnabled = false

-- Delay Values
local castDelay = 1.5
local completedDelay = 1

-- Safe Wait
local function SafeWait(t)
    local start = os.clock()
    while os.clock() - start < t do
        if not autoFishingEnabled then return false end
        task.wait()
    end
    return true
end

-- Start Fishing Cycle
local function StartFishingCycle()
    if not autoFishingEnabled then return end
    if isFishing then return end

    isFishing = true

    ChargeFishingRod:InvokeServer()
    if not SafeWait(0.2) then return end

    RequestFishingMinigameStarted:InvokeServer(unpack(miniggameArgs))
end

-- Detect "!" (minigame completed)
REReplicateTextEffect.OnClientEvent:Connect(function(data)
    if not autoFishingEnabled then return end
    if not data or not data.TextData then return end

    local attach = data.TextData.AttachTo
    if not attach or not attach.Parent then return end

    local character = attach.Parent
    local player = Players:GetPlayerFromCharacter(character)
    if player ~= LocalPlayer then return end

    task.spawn(function()
        if not SafeWait(tonumber(completedDelay) or 1) then return end
        REFishingCompleted:FireServer()
        isFishing = false

        if not SafeWait(tonumber(castDelay) or 1.5) then return end
        StartFishingCycle()
    end)
end)

-- ============================================================
--  UI BARU (FORMAT SECTIONS.Fishing)
-- ============================================================

sections.Fishing:Toggle({
	Name = "Instant Fishing",
	Default = false,
	Callback = function(state)
		autoFishingEnabled = state

        if state then
            StartFishingCycle()
        else
            isFishing = false
        end

		Window:Notify({
			Title = "Instant Fishing",
			Description = (state and "Enabled" or "Disabled") .. " Instant Fishing"
		})
	end,
}, "InstantFishingToggle")


sections.Fishing:Input({
	Name = "Cast Delay",
	Placeholder = "Default: 1.5",
	AcceptedCharacters = "Numbers",
	Callback = function(input)
		castDelay = tonumber(input) or 1.5
		Window:Notify({
			Title = "Cast Delay",
			Description = "Cast Delay set to: " .. tostring(castDelay)
		})
	end,
}, "InstantFishingCastDelay")


sections.Fishing:Input({
	Name = "Completed Delay",
	Placeholder = "Default: 1",
	AcceptedCharacters = "Numbers",
	Callback = function(input)
		completedDelay = tonumber(input) or 1
		Window:Notify({
			Title = "Completed Delay",
			Description = "Completed Delay set to: " .. tostring(completedDelay)
		})
	end,
}, "InstantFishingCompletedDelay")

sections.Fishing1:Header({
	Name = "Equipment Feature"
})

-- Module
local Net = require(ReplicatedStorage.Packages.Net)
local Replion = require(ReplicatedStorage.Packages.Replion).Client

-- RemoteEvent EquipItem
local EquipItemEvent = Net:RemoteEvent("EquipItem")

-- Data player
local data = Replion:WaitReplion("Data")

-- Variabel untuk menyimpan nama rod yang dipilih
local SelectedRodName = "Starter Rod"

-- Dropdown baru (format sections)
sections.Fishing1:Dropdown({
	Name = "Select Rod",
	Search = true,
	Multi = false,
	Options = {
		"Starter Rod",
		"Luck Rod",
		"Carbon Rod",
		"Grass Rod",
		"Demascus Rod",
		"Ice Rod",
		"Lucky Rod",
		"Midnight Rod",
		"Steampunk Rod",
		"Chrome Rod",
		"Fluorescent Rod",
		"Astral Rod",
		"Angler Rod",
		"Ares Rod",
		"Bamboo Rod",
		"Toy Rod",
		"Lava Rod",
		"Hazmat Rod",
		"Ghostfinn Rod",
		"Element Rod",
		"Angelic Rod",
		"Gold Rod",
		"Hyper Rod"
	},
	Default = "Starter Rod",
	Callback = function(Value)
		SelectedRodName = Value
	end,
}, "RodDropdown")


-- Button baru (format sections)
sections.Fishing1:Button({
	Name = "Equip Selected Rod",
	Callback = function()

		local RodIDs = {
			["Starter Rod"] = 1,
			["Luck Rod"] = 79,
			["Carbon Rod"] = 76,
			["Grass Rod"] = 85,
			["Demascus Rod"] = 77,
			["Ice Rod"] = 78,
			["Lucky Rod"] = 4,
			["Midnight Rod"] = 80,
			["Steampunk Rod"] = 6,
			["Chrome Rod"] = 7,
			["Fluorescent Rod"] = 255,
			["Astral Rod"] = 5,
			["Angler Rod"] = 168,
			["Ares Rod"] = 126,
			["Bamboo Rod"] = 258,
			["Toy Rod"] = 84,
			["Lava Rod"] = 2,
			["Hazmat Rod"] = 256,
			["Ghostfinn Rod"] = 169,
			["Element Rod"] = 257,
			["Angelic Rod"] = 124,
			["Gold Rod"] = 8,
			["Hyper Rod"] = 9
		}

		local selectedID = RodIDs[SelectedRodName]
		if not selectedID then return end

		local rods = data:GetExpect({"Inventory", "Fishing Rods"})
		if not rods then return end

		for _, rod in ipairs(rods) do
			if rod and rod.Id == selectedID then
				EquipItemEvent:FireServer(rod.UUID, "Fishing Rods")
				break
			end
		end
	end,
})

-- RemoteEvent EquipBait
local equipBaitRemote = ReplicatedStorage
    :WaitForChild("Packages")
    :WaitForChild("_Index")
    :WaitForChild("sleitnick_net@0.2.0")
    :WaitForChild("net")
    :WaitForChild("RE/EquipBait")

local selectedID = nil

-- Dropdown pilih Bait (UI Baru)
sections.Fishing1:Dropdown({
    Name = "Select Bait",
    Options = {
        "Starter Bait",
        "Topwater Bait",
        "Luck Bait",
        "Midnight Bait",
        "Nature Bait",
        "Chroma Bait",
        "Royal Bait",
        "Dark Matter Bait",
        "Corrupt Bait",
        "Aether Bait",
        "Floral Bait",
        "Singularity Bait",
        "Beach Ball Bait",
        "Gold Bait",
        "Hyper Bait"
    },
    Default = "Starter Bait",
    Search = true,

    Callback = function(selected)
        local BobberIDs = {
            ["Starter Bait"] = 1,
            ["Luck Bait"] = 2,
            ["Gold Bait"] = 4,
            ["Hyper Bait"] = 5,
            ["Chroma Bait"] = 6,
            ["Dark Matter Bait"] = 8,
            ["Beach Ball Bait"] = 9,
            ["Topwater Bait"] = 10,
            ["Corrupt Bait"] = 15,
            ["Aether Bait"] = 16,
            ["Nature Bait"] = 17,
            ["Singularity Bait"] = 18,
            ["Royal Bait"] = 19,
            ["Floral Bait"] = 20,
        }

        selectedID = BobberIDs[selected]
    end,
})

-- Tombol Equip Bait (UI Baru)
sections.Fishing1:Button({
	Name = "Equip Selected Bait",
	Callback = function()
		if selectedID then
			equipBaitRemote:FireServer(selectedID)
		end
	end,
})

-- Ambil RemoteEvent untuk equip rod
local netEvent = ReplicatedStorage:WaitForChild("Packages")
    :WaitForChild("_Index")
    :WaitForChild("sleitnick_net@0.2.0")
    :WaitForChild("net")
    :WaitForChild("RE/EquipToolFromHotbar")

local args = {1}

local autoEquipRod = false

-- Toggle Baru
sections.Fishing1:Toggle({
    Name = "Auto Equip Rod",
    Default = false,
    Callback = function(state)
        autoEquipRod = state
    end,
})

-- Loop Auto Equip
task.spawn(function()
    while true do
        if autoEquipRod then
            netEvent:FireServer(unpack(args))
        end
        task.wait(1)
    end
end)


sections.Fishing1:Header({
	Name = "Sell Feature"
})

local LocalPlayer = Players.LocalPlayer
local sellRemote = ReplicatedStorage:WaitForChild("Packages")
    :WaitForChild("_Index")
    :WaitForChild("sleitnick_net@0.2.0")
    :WaitForChild("net")
    :WaitForChild("RF/SellAllItems")

local autoSell = false
local sellDelay = 2
local mode = "Sell Delay"
local autoSellLoop = nil

-- Slider delay jual otomatis
sections.Fishing1:Slider({
	Name = "Sell Delay (seconds)",
	Default = 2,
	Minimum = 1,
	Maximum = 100,
	Rounding = 0,
	DisplayMethod = nil, -- atau bisa dihapus kalau tidak perlu
	Callback = function(value)
		sellDelay = value
	end,
}, "SellDelaySlider")

-- Dropdown mode auto sell
sections.Fishing1:Dropdown({
	Name = "Select Mode",
	Options = { "Backpack Full", "Sell Delay" },
	Default = "Sell Delay",
	Multi = false,
	Search = false,
	MaxVisibleDropdownItems = 5,
	Callback = function(option)
		mode = option
	end,
}, "SellModeDropdown")

-- Toggle auto sell
sections.Fishing1:Toggle({
	Name = "Auto Sell All Items",
	Default = false,
	Callback = function(state)
		autoSell = state

		if state then
			autoSellLoop = task.spawn(function()
				while autoSell do
					pcall(function()
						if mode == "Sell Delay" then
							sellRemote:InvokeServer()
							task.wait(sellDelay)
						elseif mode == "Backpack Full" then
							local bagLabel = LocalPlayer
								.PlayerGui
								.Inventory
								.Main
								.Top
								.Options
								.Fish
								.Label
								.BagSize

							if bagLabel and bagLabel.Text == "4,500/4,500" then
								sellRemote:InvokeServer()
							end
							task.wait(1)
						end
					end)
				end
			end)
		else
			if autoSellLoop then
				task.cancel(autoSellLoop)
				autoSellLoop = nil
			end
		end
	end,
}, "AutoSellToggle")

sections.Quest:Header({
	Name = "View Quest Status"
})

-- === DEEP SEA QUEST (UI baru dengan Section:Paragraph) ===
local board = workspace["!!! MENU RINGS"]["Deep Sea Tracker"].Board
local surfaceGui = board:WaitForChild("Gui")
local content = surfaceGui:WaitForChild("Content")
local labelNames = {"Label1", "Label2", "Label3", "Label4"}

local deepSeaParagraph = nil

-- Buat paragraph satu kali
deepSeaParagraph = sections.Quest:Paragraph({
    Header = "Deep Sea Status",
    Body = "Loading..."
})

local function updateDeepSea()
    local lines = {}

    for _, name in ipairs(labelNames) do
        local label = content:FindFirstChild(name)
        if label then
            table.insert(lines, label.Text)
        end
    end

    local newBody = table.concat(lines, "\n")

    -- INI YANG BENAR (sesuai hasil debug)
    if deepSeaParagraph and deepSeaParagraph.UpdateBody then
        deepSeaParagraph:UpdateBody(newBody)
    end
end

-- Update awal
updateDeepSea()

-- Listener setiap Label berubah
for _, name in ipairs(labelNames) do
    local label = content:FindFirstChild(name)
    if label then
        label:GetPropertyChangedSignal("Text"):Connect(updateDeepSea)
    end
end

-- === AURA BOAT QUEST (UI Baru Dengan Paragraph) ===
local auraParagraph = sections.Quest:Paragraph({
    Header = "Aura Boat Status",
    Body = "Loading..."
})

local function updateAura()
    local contentAura = workspace["!!! MENU RINGS"]["Aura Tracker"].Board.Gui.Content
    
    local combinedText = table.concat({
        contentAura.Label1.Text,
        contentAura.Label2.Text,
        contentAura.Label3.Text
    }, "\n")

    -- Update body pakai metode baru
    if auraParagraph and auraParagraph.UpdateBody then
        auraParagraph:UpdateBody(combinedText)
    end
end

task.spawn(function()
    while task.wait(1) do
        updateAura()
    end
end)

-- === ELEMENT QUEST (UI Baru Dengan Paragraph) ===
local boardElement = workspace["!!! MENU RINGS"]["Element Tracker"].Board
local surfaceGuiElement = boardElement:WaitForChild("Gui")
local contentElement = surfaceGuiElement:WaitForChild("Content")
local elementLabelNames = {"Label1", "Label2", "Label3", "Label4"}

-- Buat paragraph baru
local elementParagraph = sections.Quest:Paragraph({
    Header = "Element Status",
    Body = "Loading..."
})

local function updateElement()
    local lines = {}

    for _, name in ipairs(elementLabelNames) do
        local label = contentElement:FindFirstChild(name)
        if label then
            table.insert(lines, label.Text)
        end
    end

    local newBody = table.concat(lines, "\n")

    if elementParagraph and elementParagraph.UpdateBody then
        elementParagraph:UpdateBody(newBody)
    end
end

-- Update awal
updateElement()

-- Listener perubahan label
for _, name in ipairs(elementLabelNames) do
    local label = contentElement:FindFirstChild(name)
    if label then
        label:GetPropertyChangedSignal("Text"):Connect(updateElement)
    end
end

-- === TEMPLE LEVER STATUS (UI Baru Dengan Paragraph) ===
local Jungle = workspace:WaitForChild("JUNGLE INTERACTIONS")

local Steps = {
    "TempleLever 1",
    "TempleLever 2",
    "TempleLever 3",
    "TempleLever 4",
}

-- Buat paragraph UI baru
local templeLeverParagraph = sections.Quest:Paragraph({
    Header = "Temple Lever Status",
    Body = "Checking..."
})

local function updateStatus()
    local lines = {}

    for _, name in ipairs(Steps) do
        local lever = Jungle:FindFirstChild(name)
        local mark = "0%"

        if lever and lever:FindFirstChild("RootPart") then
            local root = lever.RootPart
            -- Jika ProximityPrompt hilang = lever sudah dipencet
            if not root:FindFirstChild("ProximityPrompt") then
                mark = "100%"
            end
        end

        table.insert(lines, string.format("%s: %s", name, mark))
    end

    local result = table.concat(lines, "\n")

    if templeLeverParagraph and templeLeverParagraph.UpdateBody then
        templeLeverParagraph:UpdateBody(result)
    end
end

task.spawn(function()
    while task.wait(1) do
        pcall(updateStatus)
    end
end)

sections.Quest1:Header({
	Name = "Auto Quest"
})

local RunService = game:GetService("RunService")
local LocalPlayer = Players.LocalPlayer

-- Konfigurasi Quest
local Quests = {
    ["Deep Sea"] = {
        Label = workspace["!!! MENU RINGS"]["Deep Sea Tracker"].Board.Gui.Content:WaitForChild("Label1"),
        PosBelum100 = CFrame.new(-3598.26392, -275.770294, -1641.81677, 0.980732918, 1.77961817e-08, -0.195353389, -9.95774929e-09, 1, 1.49543828e-08, 0.195353389, -3.92007387e-08, 0.980732918),
        PosSudah100 = CFrame.new(-3711.07275, -133.551468, -946.792786, 0.496201038, 3.27622705e-08, 0.868207633, -1.09039476e-07, 1, 1.24582756e-08, -0.868207633, -1.06866807e-07, 0.496201038)
    },
    ["Element"] = {
        Label = workspace["!!! MENU RINGS"]["Element Tracker"].Board.Gui.Content:WaitForChild("Label2"),
        PosBelum100 = CFrame.new(2117.75146, -91.1985855, -700.854065, 0.931628525, -2.26793677e-08, -0.363411963, -9.1509369e-09, 1, -8.58657501e-08, 0.363411963, 8.33205434e-08, 0.931628525),
        PosSudah100 = CFrame.new(1556.35583, 4.37500525, -605.774841, -0.154411227, 1.18263046e-07, 0.988006651, 6.54793553e-08, 1, -1.09465148e-07, -0.988006651, 4.77913886e-08, -0.154411227)
    },
    ["Aura Boat"] = {
        PosTarget = CFrame.new(88.2434769, 9.53157043, 2685.2605),
        MinLevel = 200
    },
    ["Temple Lever"] = {
        Steps = {
            { Name = "TempleLever 1", CFrame = CFrame.new(1837.76038, 6.46929169, -289.37793, 0.209234059, -5.19205168e-09, -0.977865577, -1.23823077e-10, 1, -5.33607025e-09, 0.977865577, 1.23757005e-09, 0.209234059) },
            { Name = "TempleLever 2", CFrame = CFrame.new(1407.78601, 6.59558344, 118.577896, -0.919609904, -9.32684685e-08, 0.392832845, -8.06826606e-08, 1, 4.85496443e-08, -0.392832845, 1.29519346e-08, -0.919609904) },
            { Name = "TempleLever 3", CFrame = CFrame.new(877.883911, 4.8866396, -358.809021, -0.169639081, 7.49071702e-08, 0.985506237, -4.26608402e-08, 1, -8.3352198e-08, -0.985506237, -5.61823157e-08, -0.169639081) },
            { Name = "TempleLever 4", CFrame = CFrame.new(1487.44971, 6.4896245, -847.88324, -0.996084929, -9.576409e-09, -0.0884061007, -1.68435523e-08, 1, 8.14600511e-08, 0.0884061007, 8.26301232e-08, -0.996084929) },
        }
    }
}

local selectedQuest = "Deep Sea"
local autoQuestEnabled = false
local freezeBV, freezeBG
local savedCFrame

local function Freeze(char, cf)
    local hrp = char:FindFirstChild("HumanoidRootPart")
    if not hrp then return end

    if freezeBV then freezeBV:Destroy() freezeBV = nil end
    if freezeBG then freezeBG:Destroy() freezeBG = nil end

    freezeBV = Instance.new("BodyVelocity")
    freezeBV.Velocity = Vector3.zero
    freezeBV.MaxForce = Vector3.new(9e9, 9e9, 9e9)
    freezeBV.Parent = hrp

    freezeBG = Instance.new("BodyGyro")
    freezeBG.MaxTorque = Vector3.new(9e9, 9e9, 9e9)
    freezeBG.CFrame = cf or hrp.CFrame
    freezeBG.Parent = hrp
end

local function Unfreeze()
    if freezeBV then freezeBV:Destroy() freezeBV = nil end
    if freezeBG then freezeBG:Destroy() freezeBG = nil end
end

local function TeleportOnce(cf)
    local char = LocalPlayer.Character
    if char and char:FindFirstChild("HumanoidRootPart") then
        char:SetPrimaryPartCFrame(cf)
        savedCFrame = cf
        Freeze(char, cf)
    end
end

local function RunTempleLever()
    task.spawn(function()
        local Jungle = workspace:WaitForChild("JUNGLE INTERACTIONS")
        local char = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
        local hrp = char:WaitForChild("HumanoidRootPart")
        local steps = Quests["Temple Lever"].Steps

        for _, step in ipairs(steps) do
            if not autoQuestEnabled or selectedQuest ~= "Temple Lever" then break end
            local lever = Jungle:FindFirstChild(step.Name)

            if lever and lever:FindFirstChild("RootPart") then
                hrp.CFrame = step.CFrame
                task.wait(0.5)
                local prompt = lever.RootPart:FindFirstChild("ProximityPrompt")
                if prompt then
                    fireproximityprompt(prompt)
                    task.wait(5)
                end
            end
            task.wait(1)
        end
    end)
end

local function CheckQuest()
    if not autoQuestEnabled or not selectedQuest then return end

    local char = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
    local hrp = char:WaitForChild("HumanoidRootPart")

    if selectedQuest == "Aura Boat" then
        local overhead = hrp:WaitForChild("Overhead")
        local levelLabel = overhead:WaitForChild("LevelContainer"):WaitForChild("Label")
        local level = tonumber(levelLabel.Text:match("%d+")) or 0
        if level >= Quests["Aura Boat"].MinLevel then
            TeleportOnce(Quests["Aura Boat"].PosTarget)
        end

    elseif selectedQuest == "Temple Lever" then
        RunTempleLever()

    else
        local quest = Quests[selectedQuest]
        local text = quest.Label.Text
        local persen = tonumber(text:match("(%d+)%%"))
        if persen and persen < 100 then
            TeleportOnce(quest.PosBelum100)
        else
            TeleportOnce(quest.PosSudah100)
        end
    end
end

for name, quest in pairs(Quests) do
    if quest.Label then
        quest.Label:GetPropertyChangedSignal("Text"):Connect(function()
            if selectedQuest == name and autoQuestEnabled then
                CheckQuest()
            end
        end)
    end
end

RunService.Heartbeat:Connect(function()
    if autoQuestEnabled and savedCFrame then
        local char = LocalPlayer.Character
        if char and char:FindFirstChild("HumanoidRootPart") then
            local hrp = char.HumanoidRootPart
            if (hrp.Position - savedCFrame.Position).Magnitude > 2 then
                hrp.CFrame = savedCFrame
            end
        end
    end
end)

-- UI Dropdown (baru)
sections.Quest1:Dropdown({
	Name = "Select Quest",
	Options = { "Deep Sea", "Element", "Aura Boat", "Temple Lever" },
	Default = "Deep Sea",
	Multi = false,
	Search = false,
	Callback = function(option)
		selectedQuest = option
		if autoQuestEnabled then
			CheckQuest()
		end
	end,
}, "QuestDropdown")

-- UI Toggle (baru)
sections.Quest1:Toggle({
	Name = "Auto Quest",
	Default = false,
	Callback = function(state)
		autoQuestEnabled = state
		if state then
			CheckQuest()
		else
			Unfreeze()
			savedCFrame = nil
		end
	end,
}, "AutoQuestToggle")

sections.Auto:Header({
	Name = "Auto Favorite & Trade"
})

local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")

local Net = require(ReplicatedStorage.Packages.Net)
local Replion = require(ReplicatedStorage.Packages.Replion).Client

local FavoriteItemEvent = Net:RemoteEvent("FavoriteItem")
local tradeRemote = ReplicatedStorage
    :WaitForChild("Packages")
    :WaitForChild("_Index")
    :WaitForChild("sleitnick_net@0.2.0")
    :WaitForChild("net")
    :WaitForChild("RF/InitiateTrade")

local ItemsFolder = ReplicatedStorage:WaitForChild("Items")
local data = Replion:WaitReplion("Data")

--// === MAP TIER === //--
local TierMap = {
    ["Common"] = 1,
    ["Uncommon"] = 2,
    ["Rare"] = 3,
    ["Epic"] = 4,
    ["Legendary"] = 5,
    ["Mythic"] = 6,
    ["SECRET"] = 7,
}

--// === UI ELEMENTS (baru) === //--
sections.Auto:Input({ 
    Name = "Target Player",
    Placeholder = "Example: Nexa1234",
    AcceptedCharacters = "All",
    Callback = function(input)
        Options.PlayerInput.Value = input
    end,
}, "PlayerInput")

sections.Auto:Dropdown({ 
    Name = "Select Rarity",
    Options = { "Common", "Uncommon", "Rare", "Epic", "Legendary", "Mythic", "SECRET" },
    Default = "Rare",
    Search = false,
    Multi = false,
    Required = true,
    Callback = function(value)
        Options.TierDropdown.Value = value
    end,
}, "TierDropdown")

sections.Auto:Toggle({ 
    Name = "Auto Favorite",
    Default = false,
    Callback = function(state)
        Toggles.AutoFavoriteToggle:SetValue(state)
    end,
}, "AutoFavoriteToggle")

sections.Auto:Toggle({ 
    Name = "Auto Unfavorite",
    Default = false,
    Callback = function(state)
        Toggles.AutoUnfavoriteToggle:SetValue(state)
    end,
}, "AutoUnfavoriteToggle")

sections.Auto:Toggle({ 
    Name = "Auto Trade Fish",
    Default = false,
    Callback = function(state)
        Toggles.AutoTradeToggle:SetValue(state)
    end,
}, "AutoTradeToggle")

--// === NOTIFY FUNGSIONAL (baru) === //--
local function Notify(msg, time)
    Window:Notify({
        Title = "Kuzu Hub",
        Description = msg,
        Lifetime = time or 3
    })
end

--// === FAVORITE / UNFAVORITE LOGIC (tidak diubah) === --
local function ProcessFavorite(tierTarget, setFavorite)
    local inventory = data:GetExpect("Inventory")
    local items = inventory and inventory["Items"]
    if not items then return end

    local total = 0
    for _, item in pairs(items) do
        if item and item.Favorited ~= setFavorite then
            for _, module in ipairs(ItemsFolder:GetChildren()) do
                if module:IsA("ModuleScript") then
                    local ok, moduleData = pcall(require, module)
                    if ok and moduleData.Data and moduleData.Data.Id == item.Id then
                        if moduleData.Data.Tier == tierTarget then
                            item.Favorited = setFavorite
                            FavoriteItemEvent:FireServer(item.UUID)
                            total += 1
                            task.wait(0.1)
                        end
                    end
                end
            end
        end
    end

    if total > 0 then
        Notify((setFavorite and "‚≠ê Added to favorites: " or "üíî Removed from favorites: ") .. total .. " Tier " .. tierTarget .. " item(s)", 3)
    end
end

--// === AUTO FAVORITE LOOP === --
Toggles.AutoFavoriteToggle:OnChanged(function(state)
    if state then
        task.spawn(function()
            local tierName = Options.TierDropdown.Value
            local tierTarget = TierMap[tierName]
            if not tierTarget then return end
            while Toggles.AutoFavoriteToggle.Value do
                ProcessFavorite(tierTarget, true)
                task.wait(3)
            end
        end)
    end
end)

--// === AUTO UNFAVORITE LOOP === --
Toggles.AutoUnfavoriteToggle:OnChanged(function(state)
    if state then
        task.spawn(function()
            local tierName = Options.TierDropdown.Value
            local tierTarget = TierMap[tierName]
            if not tierTarget then return end
            while Toggles.AutoUnfavoriteToggle.Value do
                ProcessFavorite(tierTarget, false)
                task.wait(3)
            end
        end)
    end
end)

--// === AUTO TRADE LOOP === --
Toggles.AutoTradeToggle:OnChanged(function(state)
    if state then
        task.spawn(function()
            local playerName = Options.PlayerInput.Value
            local tierName = Options.TierDropdown.Value
            local tierTarget = TierMap[tierName]
            if not tierTarget or not playerName or playerName == "" then
                Notify("‚ö†Ô∏è Fill in the player name and select the tier!", 3)
                Toggles.AutoTradeToggle:SetValue(false)
                return
            end

            local targetPlayer = Players:FindFirstChild(playerName)
            if not targetPlayer then
                Notify("‚ùå Player '" .. playerName .. "' not found!", 3)
                Toggles.AutoTradeToggle:SetValue(false)
                return
            end

            Notify("üöÄ Auto Trade to " .. playerName .. " (Tier: " .. tierName .. ")", 4)

            while Toggles.AutoTradeToggle.Value do
                local inventory = data:GetExpect({ "Inventory", "Items" }) or {}

                local fishTierIds = {}
                for _, module in ipairs(ItemsFolder:GetChildren()) do
                    if module:IsA("ModuleScript") then
                        local ok, itemData = pcall(require, module)
                        if ok and itemData and itemData.Data then
                            local info = itemData.Data
                            if info.Type == "Fish" and info.Tier == tierTarget then
                                fishTierIds[info.Id] = true
                            end
                        end
                    end
                end

                local tradeList = {}
                for _, invItem in pairs(inventory) do
                    if invItem and invItem.Id and fishTierIds[invItem.Id] then
                        table.insert(tradeList, invItem.UUID)
                    end
                end

                if #tradeList == 0 then
                    Notify("üé£ No fish Tier " .. tierName .. " left.", 5)
                    Toggles.AutoTradeToggle:SetValue(false)
                    break
                end

                for _, uuid in ipairs(tradeList) do
                    if not Toggles.AutoTradeToggle.Value then break end
                    pcall(function()
                        tradeRemote:InvokeServer(targetPlayer.UserId, uuid)
                    end)
                    task.wait(0.25)
                end

                task.wait(3)
            end
        end)
    end
end)

-- Config

MacLib:SetFolder("Maclib")
tabs.Config:InsertConfigSection("Left") -- karena yang ada adalah 'Config'

Window.onUnloaded(function()
	print("Unloaded!")
end)

tabs.Fishing:Select() -- pilih tab yang benar-benar ada
MacLib:LoadAutoLoadConfig()

-- ImageBotton

-- ========================================================================
-- BAGIAN YANG DITAMBAHKAN (DIGABUNG) ‚Äî TANPA MENGUBAH BAGIAN ATAS
-- ========================================================================

local TweenService = game:GetService("TweenService")
local UIS = game:GetService("UserInputService")

--======================================================
-- SCREEN GUI
--======================================================
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "NexaUIToggle"
ScreenGui.IgnoreGuiInset = true
ScreenGui.ResetOnSpawn = false
ScreenGui.Parent = player:WaitForChild("PlayerGui")

--======================================================
-- FRAME KOTAK (WARNA BIRU)
--======================================================
local ToggleFrame = Instance.new("Frame")
ToggleFrame.Parent = ScreenGui
ToggleFrame.Size = UDim2.new(0, 50, 0, 50)
ToggleFrame.Position = UDim2.new(0, 100, 0, 150)
ToggleFrame.BackgroundColor3 = Color3.fromRGB(20, 80, 200)
ToggleFrame.BorderSizePixel = 0

local Corner = Instance.new("UICorner")
Corner.CornerRadius = UDim.new(0, 14)
Corner.Parent = ToggleFrame

-- GRADIENT BIRU
local Gradient = Instance.new("UIGradient")
Gradient.Color = ColorSequence.new({
    ColorSequenceKeypoint.new(0, Color3.fromRGB(36, 112, 255)),
    ColorSequenceKeypoint.new(1, Color3.fromRGB(0, 42, 130)),
})
Gradient.Rotation = 45
Gradient.Parent = ToggleFrame

-- GLOW BIRU
local Glow = Instance.new("ImageLabel")
Glow.Parent = ToggleFrame
Glow.Size = UDim2.new(1.7, 0, 1.7, 0)
Glow.Position = UDim2.new(0.5, 0, 0.5, 0)
Glow.AnchorPoint = Vector2.new(0.5, 0.5)
Glow.BackgroundTransparency = 1
Glow.Image = "rbxassetid://12171505282"
Glow.ImageColor3 = Color3.fromRGB(0, 153, 255)
Glow.ImageTransparency = 0.35

-- BORDER
local Stroke = Instance.new("UIStroke")
Stroke.Parent = ToggleFrame
Stroke.Thickness = 2
Stroke.Color = Color3.fromRGB(140, 200, 255)
Stroke.Transparency = 0.25

--======================================================
-- IMAGE BUTTON
--======================================================
local ToggleBtn = Instance.new("ImageButton")
ToggleBtn.Parent = ToggleFrame
ToggleBtn.Size = UDim2.new(0, 40, 0, 40)
ToggleBtn.Position = UDim2.new(0.5, -20, 0.5, -20)
ToggleBtn.BackgroundTransparency = 1
ToggleBtn.Image = "rbxassetid://123906607434048"

--======================================================
-- STATE UI TOGGLE
--======================================================
local uiVisible = true

ToggleBtn.MouseButton1Click:Connect(function()
    -- shrink
    TweenService:Create(ToggleBtn, TweenInfo.new(0.08), {
        Size = UDim2.new(0, 35, 0, 35)
    }):Play()

    task.wait(0.08)

    -- expand
    TweenService:Create(ToggleBtn, TweenInfo.new(0.12), {
        Size = UDim2.new(0, 40, 0, 40)
    }):Play()

    uiVisible = not uiVisible

    if Window and Window.SetState then
        Window:SetState(uiVisible)
    else
        warn("Window:SetState tidak ditemukan")
    end
end)

--======================================================
-- UNIVERSAL DRAG SYSTEM
--======================================================
local dragging = false
local dragStart
local startPos

local function beginDrag(input)
    dragging = true
    dragStart = input.Position
    startPos = ToggleFrame.Position
end

local function updateDrag(input)
    local delta = input.Position - dragStart
    ToggleFrame.Position = UDim2.new(
        startPos.X.Scale,
        startPos.X.Offset + delta.X,
        startPos.Y.Scale,
        startPos.Y.Offset + delta.Y
    )
end

local function endDrag()
    dragging = false
end

-- Bisa ditarik dari frame & button
for _, object in ipairs({ToggleFrame, ToggleBtn}) do
    object.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1
            or input.UserInputType == Enum.UserInputType.Touch then

            beginDrag(input)

            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    endDrag()
                end
            end)
        end
    end)
end

-- Update drag
UIS.InputChanged:Connect(function(input)
    if dragging then
        if input.UserInputType == Enum.UserInputType.MouseMovement
            or input.UserInputType == Enum.UserInputType.Touch then

            updateDrag(input)
        end
    end
end)
