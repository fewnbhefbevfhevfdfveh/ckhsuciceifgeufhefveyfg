local WindUI = loadstring(game:HttpGet("https://github.com/Footagesus/WindUI/releases/latest/download/main.lua"))()

-- Deklarasi service dan variabel utama (tidak diubah) jangan di ubah ubah sama sekali
local workspace = workspace
local Players = game:GetService("Players")
local player = Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local hrp = character:WaitForChild("HumanoidRootPart")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local RunService = game:GetService("RunService")
local LocalPlayer = player -- alias supaya sama dengan LocalPlayer

local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer

WindUI:Popup({
    Title = "WELCOME TO NEXA FISH IT! SCRIPT",
    Icon = "crown",

    Content = [[
Welcome to Nexa Fish It Script.
Enjoy a faster, more stable, and more efficient automated fishing experience.
    ]],

    Buttons = {
        {
            Title = "Cancel",
            Callback = function() end,
            Variant = "Tertiary",
        },
        {
            Title = "Continue",
            Icon = "arrow-right",
            Callback = function() end,
            Variant = "Primary",
        }
    }
})

WindUI:AddTheme({
    Name = "Nexa", -- theme name

    -- Semua ini dibiarkan DEFAULT (tidak diubah)
    Accent = nil,
    Background = nil,
    BackgroundTransparency = nil,
    Outline = nil,
    Text = nil,
    Placeholder = nil,
    Button = nil,
    Icon = nil,
    Hover = nil,

    -- Hanya ubah warna window
    WindowBackground = Color3.fromHex("#002B7A"), -- biru gelap laut
    WindowShadow = Color3.fromHex("#000000"),

    -- Dialog, Tab, Element biar default → set nil
    DialogBackground = nil,
    DialogBackgroundTransparency = nil,
    DialogTitle = nil,
    DialogContent = nil,
    DialogIcon = nil,

    WindowTopbarButtonIcon = nil,
    WindowTopbarTitle = nil,
    WindowTopbarAuthor = nil,
    WindowTopbarIcon = nil,

    TabBackground = nil,
    TabTitle = nil,
    TabIcon = nil,

    ElementBackground = nil,
    ElementTitle = nil,
    ElementDesc = nil,
    ElementIcon = nil,

    PopupBackground = nil,
    PopupBackgroundTransparency = nil,
    PopupTitle = nil,
    PopupContent = nil,
    PopupIcon = nil,
})

-- GRADIENT KHUSUS WINDOW (seperti logo N: biru muda → biru gelap)
WindUI:Gradient({
    ["0"] = { Color = Color3.fromHex("#4FC3FF"), Transparency = 0 },    -- biru muda atas
    ["100"] = { Color = Color3.fromHex("#002B7A"), Transparency = 0 },  -- biru gelap bawah
}, {
    Rotation = 90,
})

local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer

-- Buat Window
local Window = WindUI:CreateWindow({
    Title = "Nexa | Premium",
    Icon = "rbxassetid://132484363980167", -- lucide icon
    Author = "Fish IT! | By Nexa Community",
    Folder = "Nexa",

    Theme = "Nexa", -- pakai tema dari versi pertama
    Transparent = true,
    Acrylic = false,
    HidePanelBackground = true,
    HideSearchBar = false,
    NewElements = true,
    Resizable = true,
    SideBarWidth = 200,
    BackgroundImageTransparency = 0.42,
    ScrollBarEnabled = true,

    User = {
        Enabled = true,
        Anonymous = false,
        Name = LocalPlayer.Name,
        Image = "rbxthumb://type=AvatarHeadShot&id=" .. LocalPlayer.UserId .. "&w=420&h=420",
        Callback = function() end,
    },
})

Window:Tag({
    Title = "v1.2.9",
    Color = Color3.fromHex("#30ff6a")
})


Window:EditOpenButton({
    Enabled = false
})

local Fishing = Window:Tab({Title = "Fishing", Icon = "fish", Locked = false})
local Quest = Window:Tab({Title = "Quest", Icon = "scroll", Locked = false})
local Auto = Window:Tab({Title = "Auto", Icon = "swords", Locked = false})
local Shop = Window:Tab({Title = "Shop", Icon = "shopping-cart", Locked = false})
local Boat = Window:Tab({Title = "Boat", Icon = "ship", Locked = false})
local Player = Window:Tab({Title = "Player", Icon = "user", Locked = false})
local Tp = Window:Tab({Title = "Teleport", Icon = "map", Locked = false})

Fishing:Select() -- Select Tab

Fishing:Section({ Title = "Fishing" })

local FishingController = require(ReplicatedStorage.Controllers.FishingController)
local AutoFishingController = require(ReplicatedStorage.Controllers.AutoFishingController)
local Replion = require(ReplicatedStorage.Packages.Replion)

local AutoFishState = {
	IsActive = false,
	MinigameActive = false
}

local ClickSpeed = 0.05

local function performClick()
	FishingController:RequestFishingMinigameClick()
	task.wait(ClickSpeed + math.random() * ClickSpeed)
end

-- Override state changed supaya selalu aktif
local originalAutoFishingStateChanged = AutoFishingController.AutoFishingStateChanged
AutoFishingController.AutoFishingStateChanged = function(...)
	return originalAutoFishingStateChanged(true)
end

local function ensureServerAutoFishingOn()
	local replionData = Replion.Client:WaitReplion("Data")
	local currentAutoFishingState = replionData:GetExpect("AutoFishing")

	if not currentAutoFishingState then
		local Net = require(ReplicatedStorage.Packages.Net)
		local UpdateAutoFishingRemote = Net:RemoteFunction("UpdateAutoFishingState")
		pcall(function()
			UpdateAutoFishingRemote:InvokeServer(true)
		end)
	end
end

local originalRodStarted = FishingController.FishingRodStarted
local originalFishingStopped = FishingController.FishingStopped
local clickThread = nil

FishingController.FishingRodStarted = function(self, ...)
	originalRodStarted(self, ...)
	if AutoFishState.IsActive and not AutoFishState.MinigameActive then
		AutoFishState.MinigameActive = true
		if clickThread then task.cancel(clickThread) end
		clickThread = task.spawn(function()
			while AutoFishState.IsActive and AutoFishState.MinigameActive do
				performClick()
			end
		end)
	end
end

FishingController.FishingStopped = function(self, ...)
	originalFishingStopped(self, ...)
	if AutoFishState.MinigameActive then
		AutoFishState.MinigameActive = false
		task.wait(1)
		ensureServerAutoFishingOn()
	end
end

local function ToggleAutoClick(shouldActivate)
	AutoFishState.IsActive = shouldActivate
	if shouldActivate then
		ensureServerAutoFishingOn()
	else
		if clickThread then
			task.cancel(clickThread)
			clickThread = nil
		end
		AutoFishState.MinigameActive = false
	end
end

local AutoFishToggle = Fishing:Toggle({
    Title = "Auto Fish Legit",
    Desc = "Enable automatic fishing",
    Value = false,
    Callback = function(state)
        ToggleAutoClick(state)
    end
})

local ShowCounterToggle = Fishing:Toggle({
    Title = "Show Fishing Counter Gui",
    Desc = "Show or hide the FishingCounterGui",
    Value = false,
    Callback = function(state)
        local fishingCounterGui = player.PlayerGui:FindFirstChild("FishingCounterGui")
        if fishingCounterGui then
            fishingCounterGui.Enabled = state
        else
            warn("FishingCounterGui not found!")
        end
    end
})

-- Ambil RemoteFunction CancelFishing
local CancelFishing = ReplicatedStorage
    :WaitForChild("Packages")
    :WaitForChild("_Index")
    :WaitForChild("sleitnick_net@0.2.0")
    :WaitForChild("net")
    :WaitForChild("RF/CancelFishingInputs")

local CancelFishingButton = Fishing:Button({
    Title = "Cancel Fishing",
    Desc = "Cancel the current fishing process",
    Locked = false,
    Callback = function()
        CancelFishing:InvokeServer()
    end
})

-- Services (Players & ReplicatedStorage sudah didefinisikan tadi, jadi tidak dibuat ulang)
local Character = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()

-- Remotes
local ChargeFishingRod = ReplicatedStorage.Packages._Index["sleitnick_net@0.2.0"].net["RF/ChargeFishingRod"]
local RequestFishingMinigameStarted = ReplicatedStorage.Packages._Index["sleitnick_net@0.2.0"].net["RF/RequestFishingMinigameStarted"]
local REReplicateTextEffect = ReplicatedStorage.Packages._Index["sleitnick_net@0.2.0"].net["RE/ReplicateTextEffect"]
local REFishingCompleted = ReplicatedStorage.Packages._Index["sleitnick_net@0.2.0"].net["RE/FishingCompleted"]

-- Step 2 args
local miniggameArgs = {
    -1.233184814453125,
    0.9972056628181873,
    1763291794.158201
}

-- Flags
local isFishing = false
local autoFishingEnabled = false

-- Delay Values
local castDelay = 1.5        
local completedDelay = 1     

-- Safe function
local function SafeWait(t)
    local start = os.clock()
    while os.clock() - start < t do
        if not autoFishingEnabled then return false end
        task.wait()
    end
    return true
end

-- Auto Fishing Start
local function StartFishingCycle()
    if not autoFishingEnabled then return end
    if isFishing then return end

    isFishing = true

    ChargeFishingRod:InvokeServer()
    if not SafeWait(0.2) then return end

    RequestFishingMinigameStarted:InvokeServer(unpack(miniggameArgs))
end

-- On minigame complete ("!")
REReplicateTextEffect.OnClientEvent:Connect(function(data)
    if not autoFishingEnabled then return end
    if not data or not data.TextData then return end

    local attach = data.TextData.AttachTo
    if not attach or not attach.Parent then return end

    local character = attach.Parent
    local player = Players:GetPlayerFromCharacter(character)
    if player ~= LocalPlayer then return end

    task.spawn(function()
        if not SafeWait(tonumber(completedDelay) or 1) then return end
        if not autoFishingEnabled then return end

        REFishingCompleted:FireServer()
        isFishing = false

        if not SafeWait(tonumber(castDelay) or 1.5) then return end
        if not autoFishingEnabled then return end

        StartFishingCycle()
    end)
end)

-- ==========================================
-- WINDUI ELEMENTS
-- ==========================================

-- Toggle Instant Fishing
local Toggle = Fishing:Toggle({
    Title = "Instant Fishing",
    Value = false,
    Callback = function(state)
        autoFishingEnabled = state

        if state then
            StartFishingCycle()
        else
            isFishing = false
        end
    end
})

Fishing:Section({ Title = "Settings" })

local SpeedInput = Fishing:Input({
    Title = "Click Speed",
    Desc = "Click speed (the smaller the faster)",
    Value = tostring(ClickSpeed),
    Type = "Input",
    Placeholder = "Example: 0.0005",
    Callback = function(input)
        local num = tonumber(input)
        if num and num > 0 then
            ClickSpeed = num
        end
    end
})

-- Cast Delay
local InputCastDelay = Fishing:Input({
    Title = "Cast Delay",
    Value = "1.5",
    Callback = function(input)
        castDelay = tonumber(input) or 1.5
    end
})

-- Completed Delay
local InputCompletedDelay = Fishing:Input({
    Title = "Completed Delay",
    Value = "1",
    Callback = function(input)
        completedDelay = tonumber(input) or 1
    end
})

Fishing:Section({ Title = "Equipment" })

-- Module
local Net = require(ReplicatedStorage.Packages.Net)
local Replion = require(ReplicatedStorage.Packages.Replion).Client

-- RemoteEvent EquipItem
local EquipItemEvent = Net:RemoteEvent("EquipItem")

-- Data player
local data = Replion:WaitReplion("Data")

-- Variabel untuk menyimpan nama rod yang dipilih
local SelectedRodName = "Starter Rod"

-- Dropdown Rods (WindUI)
local RodDropdown = Fishing:Dropdown({
    Title = "Select Rod",
    Desc = "Select the fishing rod you want to equip",
    Values = {
        "Starter Rod", "Luck Rod", "Carbon Rod", "Grass Rod", "Demascus Rod",
        "Ice Rod", "Lucky Rod", "Midnight Rod", "Steampunk Rod", "Chrome Rod",
        "Fluorescent Rod", "Astral Rod", "Angler Rod", "Ares Rod", "Bamboo Rod",
        "Toy Rod", "Lava Rod", "Hazmat Rod", "Ghostfinn Rod", "Element Rod",
        "Angelic Rod", "Gold Rod", "Hyper Rod"
    },
    Value = "Starter Rod",
    Search = true,
    Callback = function(selected)
        SelectedRodName = selected
    end
})

-- Button Equip Rod (WindUI)
local EquipRodButton = Fishing:Button({
    Title = "Equip Selected Rod",
    Desc = "Equip rod that you selected from the dropdown",
    Locked = false,
    Callback = function()

        local RodIDs = {
            ["Starter Rod"] = 1,
            ["Luck Rod"] = 79,
            ["Carbon Rod"] = 76,
            ["Grass Rod"] = 85,
            ["Demascus Rod"] = 77,
            ["Ice Rod"] = 78,
            ["Lucky Rod"] = 4,
            ["Midnight Rod"] = 80,
            ["Steampunk Rod"] = 6,
            ["Chrome Rod"] = 7,
            ["Fluorescent Rod"] = 255,
            ["Astral Rod"] = 5,
            ["Angler Rod"] = 168,
            ["Ares Rod"] = 126,
            ["Bamboo Rod"] = 258,
            ["Toy Rod"] = 84,
            ["Lava Rod"] = 2,
            ["Hazmat Rod"] = 256,
            ["Ghostfinn Rod"] = 169,
            ["Element Rod"] = 257,
            ["Angelic Rod"] = 124,
            ["Gold Rod"] = 8,
            ["Hyper Rod"] = 9
        }

        local selectedID = RodIDs[SelectedRodName]
        if not selectedID then return end

        local rods = data:GetExpect({"Inventory", "Fishing Rods"})
        if not rods then return end

        for _, rod in ipairs(rods) do
            if rod and rod.Id == selectedID then
                EquipItemEvent:FireServer(rod.UUID, "Fishing Rods")
                break
            end
        end
    end
})

-------------------------------------------------------
-- BAGIAN BAIT (digabung & tanpa mengubah kode lama)
-------------------------------------------------------

-- RemoteEvent EquipBait
local equipBaitRemote = ReplicatedStorage
    :WaitForChild("Packages")
    :WaitForChild("_Index")
    :WaitForChild("sleitnick_net@0.2.0")
    :WaitForChild("net")
    :WaitForChild("RE/EquipBait")

local selectedID = nil

-- Dropdown pilih Bait (WindUI)
local BobberDropdown = Fishing:Dropdown({
    Title = "Select Bait",
    Desc = "Select the verse you want to equip",
    Values = {
        "Starter Bait", "Topwater Bait", "Luck Bait", "Midnight Bait",
        "Nature Bait", "Chroma Bait", "Royal Bait", "Dark Matter Bait",
        "Corrupt Bait", "Aether Bait", "Floral Bait", "Singularity Bait",
        "Beach Ball Bait", "Gold Bait", "Hyper Bait"
    },
    Value = "Starter Bait",
    Search = true,
    Callback = function(selected)
        local BobberIDs = {
            ["Starter Bait"] = 1,
            ["Luck Bait"] = 2,
            ["Gold Bait"] = 4,
            ["Hyper Bait"] = 5,
            ["Chroma Bait"] = 6,
            ["Dark Matter Bait"] = 8,
            ["Beach Ball Bait"] = 9,
            ["Topwater Bait"] = 10,
            ["Corrupt Bait"] = 15,
            ["Aether Bait"] = 16,
            ["Nature Bait"] = 17,
            ["Singularity Bait"] = 18,
            ["Royal Bait"] = 19,
            ["Floral Bait"] = 20
        }

        selectedID = BobberIDs[selected]
    end
})

-- Button equip bait (WindUI)
local EquipBaitButton = Fishing:Button({
    Title = "Equip Selected Bait",
    Desc = "Equip the selected bait in the dropdown",
    Locked = false,
    Callback = function()
        if selectedID then
            equipBaitRemote:FireServer(selectedID)
        end
    end
})

-- Ambil RemoteEvent untuk equip rod
local netEvent = ReplicatedStorage:WaitForChild("Packages")
    :WaitForChild("_Index")
    :WaitForChild("sleitnick_net@0.2.0")
    :WaitForChild("net")
    :WaitForChild("RE/EquipToolFromHotbar")

local args = {1}

local autoEquipRod = false

-- WindUI Toggle (baru)
local AutoEquipRodToggle = Equipment:Toggle({
    Title = "Auto Equip Rod",
    Desc = "Automatically equip rod every 1 second",
    Icon = "fish",
    Type = "Checkbox",
    Value = false,
    Callback = function(state)
        autoEquipRod = state
    end
})

-- Loop auto-equip (tidak diubah)
spawn(function()
    while true do
        if autoEquipRod then
            netEvent:FireServer(unpack(args))
        end
        wait(1)
    end
end)


Fishing:Section({ Title = "Sell" })

-- Variabel dan remote untuk auto sell
local LocalPlayer = Players.LocalPlayer
local sellRemote = ReplicatedStorage:WaitForChild("Packages")
    :WaitForChild("_Index")
    :WaitForChild("sleitnick_net@0.2.0")
    :WaitForChild("net")
    :WaitForChild("RF/SellAllItems")

local autoSell = false
local sellDelay = 1
local mode = "Sell Delay"
local autoSellLoop = nil

-- Dropdown: Select Mode
local SellModeDropdown = Sell:Dropdown({
    Title = "Auto Sell Mode",
    Desc = "Choose how Auto Sell works",
    Values = { "Backpack Full", "Sell Delay" },
    Value = "Sell Delay",
    Callback = function(option)
        mode = option
    end
})

-- Slider: Sell Delay (seconds)
local SellDelaySlider = Sell:Slider({
    Title = "Sell Delay",
    Desc = "Delay between selling (seconds)",
    Step = 1,
    Value = {
        Min = 1,
        Max = 100,
        Default = 2,
    },
    Callback = function(value)
        sellDelay = value
    end
})

-- Toggle: Auto Sell
local AutoSellToggle = Sell:Toggle({
    Title = "Auto Sell All Items",
    Value = false,
    Callback = function(state)
        autoSell = state

        if state then
            autoSellLoop = task.spawn(function()
                while autoSell do
                    pcall(function()
                        if mode == "Sell Delay" then
                            sellRemote:InvokeServer()
                            task.wait(sellDelay)

                        elseif mode == "Backpack Full" then
                            local bagLabel = LocalPlayer
                                .PlayerGui
                                .Inventory
                                .Main
                                .Top
                                .Options
                                .Fish
                                .Label
                                .BagSize

                            if bagLabel and bagLabel.Text == "4,500/4,500" then
                                sellRemote:InvokeServer()
                            end

                            task.wait(1)
                        end
                    end)
                end
            end)

        else
            if autoSellLoop then
                task.cancel(autoSellLoop)
                autoSellLoop = nil
            end
        end
    end
})

Auto:Section({ Title = "Auto Favorite & Trade" })

--// === SETUP DASAR === //--
local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")

local Net = require(ReplicatedStorage.Packages.Net)
local Replion = require(ReplicatedStorage.Packages.Replion).Client

local FavoriteItemEvent = Net:RemoteEvent("FavoriteItem")
local tradeRemote = ReplicatedStorage
    :WaitForChild("Packages")
    :WaitForChild("_Index")
    :WaitForChild("sleitnick_net@0.2.0")
    :WaitForChild("net")
    :WaitForChild("RF/InitiateTrade")

local ItemsFolder = ReplicatedStorage:WaitForChild("Items")
local data = Replion:WaitReplion("Data")

-- UI TAB
local Auto = Tabs.Auto

--// === WINDUI INPUT === //--
local PlayerInput = Auto:Input({
    Title = "Target Player",
    Placeholder = "Example: Nexa1234",
    Type = "Input",
    Value = "",
    Callback = function(text) end
})

--// === WINDUI DROPDOWN === //--
local TierDropdown = Auto:Dropdown({
    Title = "Select Rarity",
    Desc = "Choose the tier to process",
    Values = { "Common", "Uncommon", "Rare", "Epic", "Legendary", "Mythic", "SECRET" },
    Value = { "Rare" },
    Multi = false,
    AllowNone = false,
    Callback = function(value) end
})

--// === WINDUI TOGGLES === //--
local AutoFavoriteToggle = Auto:Toggle({
    Title = "Auto Favorite",
    Value = false,
    Callback = function() end
})

local AutoUnfavoriteToggle = Auto:Toggle({
    Title = "Auto Unfavorite",
    Value = false,
    Callback = function() end
})

local AutoTradeToggle = Auto:Toggle({
    Title = "Auto Trade Fish",
    Value = false,
    Callback = function() end
})

--// === MAP TIER === //--
local TierMap = {
    ["Common"] = 1,
    ["Uncommon"] = 2,
    ["Rare"] = 3,
    ["Epic"] = 4,
    ["Legendary"] = 5,
    ["Mythic"] = 6,
    ["SECRET"] = 7,
}

--// === FUNGSI FAVORITE === //--
local function ProcessFavorite(tierTarget, setFavorite)
    local inventory = data:GetExpect("Inventory")
    local items = inventory and inventory["Items"]
    if not items then return end

    local total = 0
    for _, item in pairs(items) do
        if item and item.Favorited ~= setFavorite then
            for _, module in ipairs(ItemsFolder:GetChildren()) do
                if module:IsA("ModuleScript") then
                    local ok, moduleData = pcall(require, module)
                    if ok and moduleData.Data and moduleData.Data.Id == item.Id then
                        if moduleData.Data.Tier == tierTarget then
                            item.Favorited = setFavorite
                            FavoriteItemEvent:FireServer(item.UUID)
                            total += 1
                            task.wait(0.1)
                        end
                    end
                end
            end
        end
    end

    if total > 0 then
        WindUI:Notify({
            Title = setFavorite and "Added to Favorite" or "Removed Favorite",
            Content = total .. " item(s) (Tier " .. tierTarget .. ")",
            Duration = 3,
            Icon = "star",
        })
    end
end

--// === AUTO FAVORITE === //--
AutoFavoriteToggle:OnChanged(function(state)
    if state then
        task.spawn(function()
            while AutoFavoriteToggle.Value do
                local tierName = TierDropdown.Value[1]
                local tierTarget = TierMap[tierName]
                if tierTarget then
                    ProcessFavorite(tierTarget, true)
                end
                task.wait(3)
            end
        end)
    end
end)

--// === AUTO UNFAVORITE === //--
AutoUnfavoriteToggle:OnChanged(function(state)
    if state then
        task.spawn(function()
            while AutoUnfavoriteToggle.Value do
                local tierName = TierDropdown.Value[1]
                local tierTarget = TierMap[tierName]
                if tierTarget then
                    ProcessFavorite(tierTarget, false)
                end
                task.wait(3)
            end
        end)
    end
end)

--// === AUTO TRADE === //--
AutoTradeToggle:OnChanged(function(state)
    if state then
        task.spawn(function()
            local playerName = PlayerInput.Value
            local tierName = TierDropdown.Value[1]
            local tierTarget = TierMap[tierName]

            if not playerName or playerName == "" or not tierTarget then
                WindUI:Notify({
                    Title = "Missing Info",
                    Content = "Fill player name + select tier!",
                    Duration = 3,
                    Icon = "alert-circle",
                })
                AutoTradeToggle:SetValue(false)
                return
            end

            local targetPlayer = Players:FindFirstChild(playerName)
            if not targetPlayer then
                WindUI:Notify({
                    Title = "Player Not Found",
                    Content = playerName .. " is not in server!",
                    Duration = 3,
                    Icon = "x",
                })
                AutoTradeToggle:SetValue(false)
                return
            end

            WindUI:Notify({
                Title = "Auto Trade Started",
                Content = "Trading Tier " .. tierName .. " to " .. playerName,
                Duration = 4,
                Icon = "send",
            })

            while AutoTradeToggle.Value do
                local inventory = data:GetExpect({ "Inventory", "Items" }) or {}

                local fishTierIds = {}
                for _, module in ipairs(ItemsFolder:GetChildren()) do
                    if module:IsA("ModuleScript") then
                        local ok, itemData = pcall(require, module)
                        if ok and itemData and itemData.Data then
                            local info = itemData.Data
                            if info.Type == "Fish" and info.Tier == tierTarget then
                                fishTierIds[info.Id] = true
                            end
                        end
                    end
                end

                local tradeList = {}
                for _, invItem in pairs(inventory) do
                    if invItem and fishTierIds[invItem.Id] then
                        tradeList[#tradeList + 1] = invItem.UUID
                    end
                end

                if #tradeList == 0 then
                    WindUI:Notify({
                        Title = "No More Fish",
                        Content = "No Tier " .. tierName .. " fish left.",
                        Duration = 5,
                        Icon = "fish",
                    })
                    AutoTradeToggle:SetValue(false)
                    break
                end

                for _, uuid in ipairs(tradeList) do
                    if not AutoTradeToggle.Value then break end
                    pcall(function()
                        tradeRemote:InvokeServer(targetPlayer.UserId, uuid)
                    end)
                    task.wait(0.25)
                end

                task.wait(3)
            end
        end)
    end
end)

Auto:Section({ Title = "Auto Enchant" })

local playerGui = player:WaitForChild("PlayerGui")

-- Paragraph awal tanpa Image/Thumbnail/Buttons
local EnchantParagraph = Auto:Paragraph({
    Title = "Auto Enchant Status",
    Desc = "Loading...",
    Color = "Blue",
    Locked = false
})

-- Fungsi update paragraf
local function UpdateEnchantText(txt)
    EnchantParagraph:Set({
        Desc = txt
    })
end

task.spawn(function()
    -- Tunggu GUI muncul
    local rollEnchant = playerGui:WaitForChild("Roll Enchant")
    local main = rollEnchant:WaitForChild("Main")

    local inside
    repeat
        inside = main:FindFirstChild("Inside")
        task.wait(1)
    until inside

    UpdateEnchantText("Inside Loaded...")

    local top = inside:WaitForChild("Top")
    local enchantLabel = top:WaitForChild("EnchantLabel")

    UpdateEnchantText("Ready...")

    local lastText = ""
    while task.wait(1) do
        local currentText = enchantLabel.Text or "Unknown"
        if currentText ~= lastText then
            lastText = currentText
            UpdateEnchantText("Current Enchant: " .. currentText)
        end
    end
end)

local playerGui = player:WaitForChild("PlayerGui")

-- Library utama
local Net = require(ReplicatedStorage.Packages.Net)
local Replion = require(ReplicatedStorage.Packages.Replion).Client

-- RemoteEvent
local EquipItemEvent = Net:RemoteEvent("EquipItem")
local EquipToolEvent = ReplicatedStorage:WaitForChild("Packages"):WaitForChild("_Index")
    :WaitForChild("sleitnick_net@0.2.0"):WaitForChild("net"):WaitForChild("RE/EquipToolFromHotbar")
local ActivateAltarEvent = ReplicatedStorage:WaitForChild("Packages"):WaitForChild("_Index")
    :WaitForChild("sleitnick_net@0.2.0"):WaitForChild("net"):WaitForChild("RE/ActivateEnchantingAltar")

-- ===== WindUI ELEMENTS BARU =====

-- Dropdown baru (Multi)
local EnchantDropdown = Auto:Dropdown({
    Title = "Select Enchant",
    Desc = "Choose target enchants",
    Values = {
        "Leprechaun I",
        "Leprechaun II",
        "Mutation Hunter I",
        "Mutation Hunter II",
        "Gold Digger I",
        "Reeler I",
        "Big Hunter I",
        "Empowered I",
        "Glistening I",
        "Stargazer I",
        "Stormhunter I",
        "XPerienced I",
        "Cursed I",
        "Prismatic I"
    },
    Value = { "Leprechaun I" },
    Multi = true,
    AllowNone = true,
    Searchable = true,
    Callback = function(selected)
        print("Selected enchants:")
        print(game:GetService("HttpService"):JSONEncode(selected))
    end
})

-- Toggle baru
local AutoEnchantToggle = Auto:Toggle({
    Title = "Auto Enchant",
    Value = false,
    Callback = function(state)
        print("Auto Enchant:", state)
    end
})

-- Notify singkat
local function SendNotify(title, content)
    WindUI:Notify({
        Title = title,
        Content = content,
        Duration = 3,
        Icon = "sparkles"
    })
end

-- ===== Fungsi cek enchant =====
local function isTargetEnchant(text)
    local selected = EnchantDropdown.Value
    for _, name in pairs(selected) do
        if string.find(text, name) then
            return true
        end
    end
    return false
end

-- ===== TASK CONTROL =====
local currentTask

-- ===== Proses enchant utama =====
local function doEnchantCycle()
    local data = Replion:WaitReplion("Data")
    local inventory = data:GetExpect("Inventory")
    local items = inventory and inventory["Items"]
    if not items then return false end

    local moduleTarget = ReplicatedStorage.Items:FindFirstChild("Enchant Stone")
    if not moduleTarget then return false end

    local ok, moduleData = pcall(require, moduleTarget)
    local targetId = ok and moduleData.Data and moduleData.Data.Id
    if not targetId then return false end

    -- Equip Enchant Stone
    local equipped = false
    for _, item in pairs(items) do
        if item.Id == targetId and not item.Equip then
            EquipItemEvent:FireServer(item.UUID, "Enchant Stones")
            item.Equip = true
            equipped = true
            break
        end
    end

    if not equipped then return false end
    task.wait(1)

    EquipToolEvent:FireServer(5)
    task.wait(1)

    ActivateAltarEvent:FireServer()

    local rollEnchant = playerGui:WaitForChild("Roll Enchant")
    local main = rollEnchant:WaitForChild("Main")

    local inside
    repeat
        inside = main:FindFirstChild("Inside")
        task.wait(1)
    until inside or not AutoEnchantToggle.Value

    if not AutoEnchantToggle.Value then return false end

    local top = inside:WaitForChild("Top")
    local enchantLabel = top:WaitForChild("EnchantLabel")

    task.wait(3)

    while AutoEnchantToggle.Value and task.wait(1) do
        local currentText = enchantLabel.Text

        if isTargetEnchant(currentText) then
            SendNotify("Enchant Found!", currentText)
            return true
        end

        if currentText ~= "" and currentText ~= "..." and currentText ~= "Rolling..." then
            return false
        end
    end

    return false
end

-- ===== Sistem Toggle Baru =====
AutoEnchantToggle:OnChanged(function(state)
    if state then
        if currentTask then
            task.cancel(currentTask)
        end

        currentTask = task.spawn(function()
            while AutoEnchantToggle.Value do
                local success = doEnchantCycle()

                if success then
                    AutoEnchantToggle:Set(false)
                    break
                else
                    task.wait(3)
                end
            end
        end)

    else
        if currentTask then
            task.cancel(currentTask)
            currentTask = nil
        end
    end
end)
